/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t=function(e,t){if(!e)throw n(t)},n=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},i=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const s=e[t],r=t+1<e.length,o=r?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=s>>2,h=(3&s)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(u=64)),i.push(n[l],n[h],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new r;const l=s<<2|o>>4;if(i.push(l),64!==a){const e=o<<4&240|a>>2;if(i.push(e),64!==c){const e=a<<6&192|c;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){const t=i(e);return s.encodeByteArray(t,!0)},a=function(e){return o(e).replace(/\./g,"")},c=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function l(e){return h(void 0,e)}function h(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=h(e[n],t[n]));return e}const u=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&c(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},d=()=>{var e;return null===(e=u())||void 0===e?void 0:e.config};class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function f(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function _(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())}function m(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function g(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function y(){try{return"object"==typeof indexedDB}catch(e){return!1}}function v(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class w extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,I.prototype.create)}}class I{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],r=s?function(e,t){return e.replace(b,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new w(i,o,n)}}const b=/\{\$([^}]+)}/g;function C(e){return JSON.parse(e)}function T(e){return JSON.stringify(e)}const E=function(e){let t={},n={},i={},s="";try{const r=e.split(".");t=C(c(r[0])||""),n=C(c(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:s}};function k(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function N(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function P(e,t,n){const i={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=t.call(n,e[s],s,e));return i}function R(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(D(n)&&D(r)){if(!R(n,r))return!1}else if(n!==r)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function D(e){return null!==e&&"object"==typeof e}function O(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function A(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function x(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class M{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let i,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=c^o&(a^c),s=1518500249):(i=o^a^c,s=1859775393):e<60?(i=o&a|c&(o|a),s=2400959708):(i=o^a^c,s=3395469782);const t=(r<<5|r>>>27)+i+l+s+n[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const s=this.buf_;let r=this.inbuf_;for(;i<t;){if(0===r)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(s[r]=e.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}else for(;i<t;)if(s[r]=e[i],++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class L{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=F),void 0===i.error&&(i.error=F),void 0===i.complete&&(i.complete=F);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function F(){}function U(e,t){return`${e} failed: ${t} argument `}const q=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t},j=1e3,W=2,B=144e5,V=.5;function H(e,t=j,n=W){const i=t*Math.pow(n,e),s=Math.round(V*i*(Math.random()-.5)*2);return Math.min(B,i+s)}function z(e){return e&&e._delegate?e._delegate:e}class ${constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const K="[DEFAULT]";class G{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new p;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:K})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=K){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=K){return this.instances.has(e)}getOptions(e=K){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===K?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e=K){return this.component?this.component.multipleInstances?e:K:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Y{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new G(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const J=[];var Q;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Q||(Q={}));const X={debug:Q.DEBUG,verbose:Q.VERBOSE,info:Q.INFO,warn:Q.WARN,error:Q.ERROR,silent:Q.SILENT},Z=Q.INFO,ee={[Q.DEBUG]:"log",[Q.VERBOSE]:"log",[Q.INFO]:"info",[Q.WARN]:"warn",[Q.ERROR]:"error"},te=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),s=ee[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${i}]  ${e.name}:`,...n)};class ne{constructor(e){this.name=e,this._logLevel=Z,this._logHandler=te,this._userLogHandler=null,J.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Q))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?X[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Q.DEBUG,...e),this._logHandler(this,Q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Q.VERBOSE,...e),this._logHandler(this,Q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Q.INFO,...e),this._logHandler(this,Q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Q.WARN,...e),this._logHandler(this,Q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Q.ERROR,...e),this._logHandler(this,Q.ERROR,...e)}}const ie=(e,t)=>t.some((t=>e instanceof t));let se,re;const oe=new WeakMap,ae=new WeakMap,ce=new WeakMap,le=new WeakMap,he=new WeakMap;let ue={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ae.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ce.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return pe(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function de(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(re||(re=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(fe(this),e),pe(oe.get(this))}:function(...e){return pe(t.apply(fe(this),e))}:function(e,...n){const i=t.call(fe(this),e,...n);return ce.set(i,e.sort?e.sort():[e]),pe(i)}:(e instanceof IDBTransaction&&function(e){if(ae.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)}));ae.set(e,t)}(e),ie(e,se||(se=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,ue):e);var t}function pe(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(pe(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&oe.set(t,e)})).catch((()=>{})),he.set(t,e),t}(e);if(le.has(e))return le.get(e);const t=de(e);return t!==e&&(le.set(e,t),he.set(t,e)),t}const fe=e=>he.get(e),_e=["get","getKey","getAll","getAllKeys","count"],me=["put","add","delete","clear"],ge=new Map;function ye(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ge.get(t))return ge.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=me.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!_e.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&r.done]))[0]};return ge.set(t,r),r}var ve;ve=ue,ue={...ve,get:(e,t,n)=>ye(e,t)||ve.get(e,t,n),has:(e,t)=>!!ye(e,t)||ve.has(e,t)};class we{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Ie="@firebase/app",be="0.9.15",Ce=new ne("@firebase/app"),Te="[DEFAULT]",Ee={[Ie]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ke=new Map,Se=new Map;function Ne(e,t){try{e.container.addComponent(t)}catch(n){Ce.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Pe(e){const t=e.name;if(Se.has(t))return Ce.debug(`There were multiple attempts to register component ${t}.`),!1;Se.set(t,e);for(const t of ke.values())Ne(t,e);return!0}function Re(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const De=new I("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Oe{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new $("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw De.create("app-deleted",{appName:this._name})}}const Ae="10.1.0";function xe(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:Te,automaticDataCollectionEnabled:!1},t),s=i.name;if("string"!=typeof s||!s)throw De.create("bad-app-name",{appName:String(s)});if(n||(n=d()),!n)throw De.create("no-options");const r=ke.get(s);if(r){if(R(n,r.options)&&R(i,r.config))return r;throw De.create("duplicate-app",{appName:s})}const o=new Y(s);for(const e of Se.values())o.addComponent(e);const a=new Oe(n,i,o);return ke.set(s,a),a}function Me(e,t,n){var i;let s=null!==(i=Ee[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const e=[`Unable to register library "${s}" with version "${t}":`];return r&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Ce.warn(e.join(" "))}Pe(new $(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const Le="firebase-heartbeat-database",Fe=1,Ue="firebase-heartbeat-store";let qe=null;function je(){return qe||(qe=function(e,t,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(e,t),a=pe(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(pe(o.result),e.oldVersion,e.newVersion,pe(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{r&&e.addEventListener("close",(()=>r())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(Le,Fe,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Ue)}}).catch((e=>{throw De.create("idb-open",{originalErrorMessage:e.message})}))),qe}async function We(e,t){try{const n=(await je()).transaction(Ue,"readwrite"),i=n.objectStore(Ue);await i.put(t,Be(e)),await n.done}catch(e){if(e instanceof w)Ce.warn(e.message);else{const t=De.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});Ce.warn(t.message)}}}function Be(e){return`${e.name}!${e.options.appId}`}class Ve{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ze(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=He();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=He(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let i=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),$e(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),$e(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=a(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function He(){return(new Date).toISOString().substring(0,10)}class ze{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!y()&&v().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await je();return await t.transaction(Ue).objectStore(Ue).get(Be(e))}catch(e){if(e instanceof w)Ce.warn(e.message);else{const t=De.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});Ce.warn(t.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return We(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return We(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function $e(e){return a(JSON.stringify({version:2,heartbeats:e})).length}Pe(new $("platform-logger",(e=>new we(e)),"PRIVATE")),Pe(new $("heartbeat",(e=>new Ve(e)),"PRIVATE")),Me(Ie,be,""),Me(Ie,be,"esm2017"),Me("fire-js",""),Me("firebase","10.1.0","app");const Ke="@firebase/database",Ge="1.0.1";let Ye="";class Je{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),T(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:C(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Qe{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return k(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Xe=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Je(t)}}catch(e){}return new Qe},Ze=Xe("localStorage"),et=Xe("sessionStorage"),tt=new ne("@firebase/database"),nt=function(){let e=1;return function(){return e++}}(),it=function(e){const n=function(e){const n=[];let i=0;for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);if(r>=55296&&r<=56319){const n=r-55296;s++,t(s<e.length,"Surrogate pair missing trail surrogate."),r=65536+(n<<10)+(e.charCodeAt(s)-56320)}r<128?n[i++]=r:r<2048?(n[i++]=r>>6|192,n[i++]=63&r|128):r<65536?(n[i++]=r>>12|224,n[i++]=r>>6&63|128,n[i++]=63&r|128):(n[i++]=r>>18|240,n[i++]=r>>12&63|128,n[i++]=r>>6&63|128,n[i++]=63&r|128)}return n}(e),i=new M;i.update(n);const r=i.digest();return s.encodeByteArray(r)},st=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=st.apply(null,i):t+="object"==typeof i?T(i):i,t+=" "}return t};let rt=null,ot=!0;const at=function(...e){if(!0===ot&&(ot=!1,null===rt&&!0===et.get("logging_enabled")&&(n=!0,t(!i||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(tt.logLevel=Q.VERBOSE,rt=tt.log.bind(tt),i&&et.set("logging_enabled",!0)):"function"==typeof n?rt=n:(rt=null,et.remove("logging_enabled")))),rt){const t=st.apply(null,e);rt(t)}var n,i},ct=function(e){return function(...t){at(e,...t)}},lt=function(...e){const t="FIREBASE INTERNAL ERROR: "+st(...e);tt.error(t)},ht=function(...e){const t=`FIREBASE FATAL ERROR: ${st(...e)}`;throw tt.error(t),new Error(t)},ut=function(...e){const t="FIREBASE WARNING: "+st(...e);tt.warn(t)},dt=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},pt="[MIN_NAME]",ft="[MAX_NAME]",_t=function(e,t){if(e===t)return 0;if(e===pt||t===ft)return-1;if(t===pt||e===ft)return 1;{const n=Ct(e),i=Ct(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},mt=function(e,t){return e===t?0:e<t?-1:1},gt=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+T(t))},yt=function(e){if("object"!=typeof e||null===e)return T(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=T(t[i]),n+=":",n+=yt(e[t[i]]);return n+="}",n},vt=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let s=0;s<n;s+=t)s+t>n?i.push(e.substring(s,n)):i.push(e.substring(s,s+t));return i};function wt(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const It=function(e){t(!dt(e),"Invalid JSON number");let n,i,s,r,o;0===e?(i=0,s=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),i=r+1023,s=Math.round(e*Math.pow(2,52-r)-Math.pow(2,52))):(i=0,s=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(s%2?1:0),s=Math.floor(s/2);for(o=11;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);a.push(n?1:0),a.reverse();const c=a.join("");let l="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},bt=new RegExp("^-?(0*)\\d{1,10}$"),Ct=function(e){if(bt.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Tt=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw ut("Exception was thrown by user callback.",t),e}),Math.floor(0))}},Et=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class kt{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){ut(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class St{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(at("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ut(e)}}class Nt{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Nt.OWNER="owner";const Pt="5",Rt=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Dt="ac",Ot="websocket",At="long_polling";class xt{constructor(e,t,n,i,s=!1,r="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ze.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ze.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Mt(e,n,i){let s;if(t("string"==typeof n,"typeof type must == string"),t("object"==typeof i,"typeof params must == object"),n===Ot)s=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(n!==At)throw new Error("Unknown connection type: "+n);s=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(i.ns=e.namespace);const r=[];return wt(i,((e,t)=>{r.push(e+"="+t)})),s+r.join("&")}class Lt{constructor(){this.counters_={}}incrementCounter(e,t=1){k(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return l(this.counters_)}}const Ft={},Ut={};function qt(e){const t=e.toString();return Ft[t]||(Ft[t]=new Lt),Ft[t]}class jt{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Tt((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Wt="start";class Bt{constructor(e,t,n,i,s,r,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ct(e),this.stats_=qt(t),this.urlFn=e=>(this.appCheckToken&&(e[Dt]=this.appCheckToken),Mt(t,At,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new jt(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Vt(((...e)=>{const[t,n,i,s,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Wt)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[Wt]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Pt,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[Dt]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Rt.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Bt.forceAllow_=!0}static forceDisallow(){Bt.forceDisallow_=!0}static isAvailable(){return!(!Bt.forceAllow_&&(Bt.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=T(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=o(t),i=vt(n,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=T(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Vt{constructor(e,t,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=nt(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Vt.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){at("frame writing exception"),e.stack&&at(e.stack),at(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||at("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{at("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let Ht=null;"undefined"!=typeof MozWebSocket?Ht=MozWebSocket:"undefined"!=typeof WebSocket&&(Ht=WebSocket);class zt{constructor(e,t,n,i,s,r,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ct(this.connId),this.stats_=qt(t),this.connURL=zt.connectionURL_(t,r,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,s){const r={};return r.v=Pt,"undefined"!=typeof location&&location.hostname&&Rt.test(location.hostname)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),i&&(r[Dt]=i),s&&(r.p=s),Mt(e,Ot,r)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ze.set("previous_websocket_failure",!0);try{let e;0,this.mySock=new Ht(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){zt.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Ht&&!zt.forceDisallow_}static previouslyFailed(){return Ze.isInMemoryStorage||!0===Ze.get("previous_websocket_failure")}markConnectionHealthy(){Ze.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=C(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(t(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=T(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=vt(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}zt.responsesRequiredToBeHealthy=2,zt.healthyTimeout=3e4;class $t{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Bt,zt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=zt&&zt.isAvailable();let n=t&&!zt.previouslyFailed();if(e.webSocketOnly&&(t||ut("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[zt];else{const e=this.transports_=[];for(const t of $t.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);$t.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}$t.globalTransportInitialized_=!1;class Kt{constructor(e,t,n,i,s,r,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ct("c:"+this.id+":"),this.transportManager_=new $t(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Et((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=gt("t",e),n=gt("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=gt("t",e),n=gt("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=gt("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?lt("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):lt("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Pt!==n&&ut("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Et((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Et((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ze.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Gt{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Yt{constructor(e){this.allowedEvents_=e,this.listeners_={},t(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){t(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class Jt extends Yt{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||_()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Jt}getInitialEvent(e){return t("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Qt{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Xt(){return new Qt("")}function Zt(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function en(e){return e.pieces_.length-e.pieceNum_}function tn(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Qt(e.pieces_,t)}function nn(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function sn(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function rn(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Qt(t,0)}function on(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof Qt)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Qt(n,0)}function an(e){return e.pieceNum_>=e.pieces_.length}function cn(e,t){const n=Zt(e),i=Zt(t);if(null===n)return t;if(n===i)return cn(tn(e),tn(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function ln(e,t){if(en(e)!==en(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function hn(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(en(e)>en(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class un{constructor(e,t){this.errorPrefix_=t,this.parts_=sn(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=q(this.parts_[e]);dn(this)}}function dn(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+pn(e))}function pn(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class fn extends Yt{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new fn}getInitialEvent(e){return t("visible"===e,"Unknown event type: "+e),[this.visible_]}}const _n=1e3;class mn extends Gt{constructor(e,t,n,i,s,r,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=mn.nextPersistentConnectionId_++,this.log_=ct("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=_n,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");fn.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Jt.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,i){const s=++this.requestNumber_,r={r:s,a:e,b:n};this.log_(T(r)),t(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new p,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,n,i,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),t(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),t(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:n,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n};e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,(s=>{const r=s.d,o=s.s;mn.warnOnListenWarnings_(r,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,r))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&k(e,"w")){const n=S(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();ut(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=E(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=E(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,n){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),t(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,n)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const s={p:e};i&&(s.q=n,s.t=i),this.sendRequest("n",s)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const s={p:t,d:n};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,s){this.initConnection_();const r={p:t,d:n};void 0!==s&&(r.h=s),this.outstandingPuts_.push({action:e,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+T(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):lt("Unrecognized action received from server: "+T(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){t(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=_n,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=_n,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=_n),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+mn.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,i())},l=function(e){t(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:l};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[t,c]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?at("getToken() completed but was canceled"):(at("getToken() completed. Creating connection."),this.authToken_=t&&t.accessToken,this.appCheckToken_=c&&c.token,a=new Kt(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,i,(e=>{ut(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&ut(e),c())}}}interrupt(e){at("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){at("Resuming connection for reason: "+e),delete this.interruptReasons_[e],N(this.interruptReasons_)&&(this.reconnectDelay_=_n,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>yt(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new Qt(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){at("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){at("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Ye.replace(/\./g,"-")]=1,_()?e["framework.cordova"]=1:g()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Jt.getInstance().currentlyOnline();return N(this.interruptReasons_)&&e}}mn.nextPersistentConnectionId_=0,mn.nextConnectionId_=0;class gn{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new gn(e,t)}}class yn{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new gn(pt,e),i=new gn(pt,t);return 0!==this.compare(n,i)}minPost(){return gn.MIN}}let vn;class wn extends yn{static get __EMPTY_NODE(){return vn}static set __EMPTY_NODE(e){vn=e}compare(e,t){return _t(e.name,t.name)}isDefinedOn(e){throw n("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return gn.MIN}maxPost(){return new gn(ft,vn)}makePost(e,n){return t("string"==typeof e,"KeyIndex indexValue must always be a string."),new gn(e,vn)}toString(){return".key"}}const In=new wn;class bn{constructor(e,t,n,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,i&&(r*=-1),r<0)e=this.isReverse_?e.left:e.right;else{if(0===r){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Cn{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Cn.RED,this.left=null!=i?i:Tn.EMPTY_NODE,this.right=null!=s?s:Tn.EMPTY_NODE}copy(e,t,n,i,s){return new Cn(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Tn.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Tn.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Cn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Cn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Cn.RED=!0,Cn.BLACK=!1;class Tn{constructor(e,t=Tn.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Tn(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Cn.BLACK,null,null))}remove(e){return new Tn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Cn.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new bn(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new bn(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new bn(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new bn(this.root_,null,this.comparator_,!0,e)}}function En(e,t){return _t(e.name,t.name)}function kn(e,t){return _t(e,t)}let Sn;Tn.EMPTY_NODE=new class{copy(e,t,n,i,s){return this}insert(e,t,n){return new Cn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Nn=function(e){return"number"==typeof e?"number:"+It(e):"string:"+e},Pn=function(e){if(e.isLeafNode()){const n=e.val();t("string"==typeof n||"number"==typeof n||"object"==typeof n&&k(n,".sv"),"Priority must be a string or number.")}else t(e===Sn||e.isEmpty(),"priority of unexpected type.");t(e===Sn||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Rn,Dn,On;class An{constructor(e,n=An.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,t(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Pn(this.priorityNode_)}static set __childrenNodeConstructor(e){Rn=e}static get __childrenNodeConstructor(){return Rn}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new An(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:An.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return an(e)?this:".priority"===Zt(e)?this.priorityNode_:An.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:An.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,n){const i=Zt(e);return null===i?n:n.isEmpty()&&".priority"!==i?this:(t(".priority"!==i||1===en(e),".priority must be the last token in a path"),this.updateImmediateChild(i,An.__childrenNodeConstructor.EMPTY_NODE.updateChild(tn(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Nn(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?It(this.value_):this.value_,this.lazyHash_=it(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===An.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof An.__childrenNodeConstructor?-1:(t(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,i=typeof this.value_,s=An.VALUE_TYPE_ORDER.indexOf(n),r=An.VALUE_TYPE_ORDER.indexOf(i);return t(s>=0,"Unknown leaf type: "+n),t(r>=0,"Unknown leaf type: "+i),s===r?"object"===i?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}An.VALUE_TYPE_ORDER=["object","boolean","number","string"];const xn=new class extends yn{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),s=n.compareTo(i);return 0===s?_t(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return gn.MIN}maxPost(){return new gn(ft,new An("[PRIORITY-POST]",On))}makePost(e,t){const n=Dn(e);return new gn(t,new An("[PRIORITY-POST]",n))}toString(){return".priority"}},Mn=Math.log(2);class Ln{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Mn,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Fn=function(e,t,n,i){e.sort(t);const s=function(t,i){const r=i-t;let o,a;if(0===r)return null;if(1===r)return o=e[t],a=n?n(o):o,new Cn(a,o.node,Cn.BLACK,null,null);{const c=parseInt(r/2,10)+t,l=s(t,c),h=s(c+1,i);return o=e[c],a=n?n(o):o,new Cn(a,o.node,Cn.BLACK,l,h)}},r=function(t){let i=null,r=null,o=e.length;const a=function(t,i){const r=o-t,a=o;o-=t;const l=s(r+1,a),h=e[r],u=n?n(h):h;c(new Cn(u,h.node,i,null,l))},c=function(e){i?(i.left=e,i=e):(r=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,Cn.BLACK):(a(i,Cn.BLACK),a(i,Cn.RED))}return r}(new Ln(e.length));return new Tn(i||t,r)};let Un;const qn={};class jn{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return t(qn&&xn,"ChildrenNode.ts has not been loaded"),Un=Un||new jn({".priority":qn},{".priority":xn}),Un}get(e){const t=S(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Tn?t:null}hasIndex(e){return k(this.indexSet_,e.toString())}addIndex(e,n){t(e!==In,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=n.getIterator(gn.Wrap);let o,a=r.getNext();for(;a;)s=s||e.isDefinedOn(a.node),i.push(a),a=r.getNext();o=s?Fn(i,e.getCompare()):qn;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const h=Object.assign({},this.indexes_);return h[c]=o,new jn(h,l)}addToIndexes(e,n){const i=P(this.indexes_,((i,s)=>{const r=S(this.indexSet_,s);if(t(r,"Missing index implementation for "+s),i===qn){if(r.isDefinedOn(e.node)){const t=[],i=n.getIterator(gn.Wrap);let s=i.getNext();for(;s;)s.name!==e.name&&t.push(s),s=i.getNext();return t.push(e),Fn(t,r.getCompare())}return qn}{const t=n.get(e.name);let s=i;return t&&(s=s.remove(new gn(e.name,t))),s.insert(e,e.node)}}));return new jn(i,this.indexSet_)}removeFromIndexes(e,t){const n=P(this.indexes_,(n=>{if(n===qn)return n;{const i=t.get(e.name);return i?n.remove(new gn(e.name,i)):n}}));return new jn(n,this.indexSet_)}}let Wn;class Bn{constructor(e,n,i){this.children_=e,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Pn(this.priorityNode_),this.children_.isEmpty()&&t(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Wn||(Wn=new Bn(new Tn(kn),null,jn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Wn}updatePriority(e){return this.children_.isEmpty()?this:new Bn(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Wn:t}}getChild(e){const t=Zt(e);return null===t?this:this.getImmediateChild(t).getChild(tn(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,n){if(t(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);{const t=new gn(e,n);let i,s;n.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(t,this.children_)):(i=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(t,this.children_));const r=i.isEmpty()?Wn:this.priorityNode_;return new Bn(i,r,s)}}updateChild(e,n){const i=Zt(e);if(null===i)return n;{t(".priority"!==Zt(e)||1===en(e),".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(tn(e),n);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,s=!0;if(this.forEachChild(xn,((r,o)=>{t[r]=o.val(e),n++,s&&Bn.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):s=!1})),!e&&s&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Nn(this.getPriority().val())+":"),this.forEachChild(xn,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":it(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new gn(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new gn(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new gn(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,gn.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,gn.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Vn?-1:0}withIndex(e){if(e===In||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Bn(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===In||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(xn),n=t.getIterator(xn);let i=e.getNext(),s=n.getNext();for(;i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=e.getNext(),s=n.getNext()}return null===i&&null===s}return!1}return!1}}resolveIndex_(e){return e===In?null:this.indexMap_.get(e.toString())}}Bn.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Vn=new class extends Bn{constructor(){super(new Tn(kn),Bn.EMPTY_NODE,jn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Bn.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(gn,{MIN:{value:new gn(pt,Bn.EMPTY_NODE)},MAX:{value:new gn(ft,Vn)}}),wn.__EMPTY_NODE=Bn.EMPTY_NODE,An.__childrenNodeConstructor=Bn,Sn=Vn,On=Vn;const Hn=!0;function zn(e,n=null){if(null===e)return Bn.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(n=e[".priority"]),t(null===n||"string"==typeof n||"number"==typeof n||"object"==typeof n&&".sv"in n,"Invalid priority type found: "+typeof n),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new An(e,zn(n));if(e instanceof Array||!Hn){let t=Bn.EMPTY_NODE;return wt(e,((n,i)=>{if(k(e,n)&&"."!==n.substring(0,1)){const e=zn(i);!e.isLeafNode()&&e.isEmpty()||(t=t.updateImmediateChild(n,e))}})),t.updatePriority(zn(n))}{const t=[];let i=!1;if(wt(e,((e,n)=>{if("."!==e.substring(0,1)){const s=zn(n);s.isEmpty()||(i=i||!s.getPriority().isEmpty(),t.push(new gn(e,s)))}})),0===t.length)return Bn.EMPTY_NODE;const s=Fn(t,En,(e=>e.name),kn);if(i){const e=Fn(t,xn.getCompare());return new Bn(s,zn(n),new jn({".priority":e},{".priority":xn}))}return new Bn(s,zn(n),jn.Default)}}!function(e){Dn=e}(zn);class $n extends yn{constructor(e){super(),this.indexPath_=e,t(!an(e)&&".priority"!==Zt(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),s=n.compareTo(i);return 0===s?_t(e.name,t.name):s}makePost(e,t){const n=zn(e),i=Bn.EMPTY_NODE.updateChild(this.indexPath_,n);return new gn(t,i)}maxPost(){const e=Bn.EMPTY_NODE.updateChild(this.indexPath_,Vn);return new gn(ft,e)}toString(){return sn(this.indexPath_,0).join("/")}}const Kn=new class extends yn{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?_t(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return gn.MIN}maxPost(){return gn.MAX}makePost(e,t){const n=zn(e);return new gn(t,n)}toString(){return".value"}};function Gn(e){return{type:"value",snapshotNode:e}}function Yn(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Jn(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Qn(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Xn{constructor(e){this.index_=e}updateChild(e,n,i,s,r,o){t(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()?e:(null!=o&&(i.isEmpty()?e.hasChild(n)?o.trackChildChange(Jn(n,a)):t(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Yn(n,i)):o.trackChildChange(Qn(n,i,a))),e.isLeafNode()&&i.isEmpty()?e:e.updateImmediateChild(n,i).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(xn,((e,i)=>{t.hasChild(e)||n.trackChildChange(Jn(e,i))})),t.isLeafNode()||t.forEachChild(xn,((t,i)=>{if(e.hasChild(t)){const s=e.getImmediateChild(t);s.equals(i)||n.trackChildChange(Qn(t,i,s))}else n.trackChildChange(Yn(t,i))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Bn.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Zn{constructor(e){this.indexedFilter_=new Xn(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Zn.getStartPost_(e),this.endPost_=Zn.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,s,r){return this.matches(new gn(t,n))||(n=Bn.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,s,r)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Bn.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(Bn.EMPTY_NODE);const s=this;return t.forEachChild(xn,((e,t)=>{s.matches(new gn(e,t))||(i=i.updateImmediateChild(e,Bn.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class ei{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Zn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,s,r){return this.rangedFilter_.matches(new gn(t,n))||(n=Bn.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,s,r):this.fullLimitUpdateChild_(e,t,n,s,r)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=Bn.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=Bn.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;i=i.updateImmediateChild(t.name,t.node),n++}}}else{let e;i=t.withIndex(this.index_),i=i.updatePriority(Bn.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,Bn.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,i,s,r){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;t(a.numChildren()===this.limit_,"");const c=new gn(n,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(n)){const e=a.getImmediateChild(n);let t=s.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=t&&(t.name===n||a.hasChild(t.name));)t=s.getChildAfterChild(this.index_,t,this.reverse_);const u=null==t?1:o(t,c);if(h&&!i.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(Qn(n,i,e)),a.updateImmediateChild(n,i);{null!=r&&r.trackChildChange(Jn(n,e));const i=a.updateImmediateChild(n,Bn.EMPTY_NODE);return null!=t&&this.rangedFilter_.matches(t)?(null!=r&&r.trackChildChange(Yn(t.name,t.node)),i.updateImmediateChild(t.name,t.node)):i}}return i.isEmpty()?e:h&&o(l,c)>=0?(null!=r&&(r.trackChildChange(Jn(l.name,l.node)),r.trackChildChange(Yn(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(l.name,Bn.EMPTY_NODE)):e}}class ti{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=xn}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return t(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return t(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:pt}hasEnd(){return this.endSet_}getIndexEndValue(){return t(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return t(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ft}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return t(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===xn}copy(){const e=new ti;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ni(e){const n={};if(e.isDefault())return n;let i;if(e.index_===xn?i="$priority":e.index_===Kn?i="$value":e.index_===In?i="$key":(t(e.index_ instanceof $n,"Unrecognized index type!"),i=e.index_.toString()),n.orderBy=T(i),e.startSet_){const t=e.startAfterSet_?"startAfter":"startAt";n[t]=T(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+T(e.indexStartName_))}if(e.endSet_){const t=e.endBeforeSet_?"endBefore":"endAt";n[t]=T(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+T(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function ii(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==xn&&(t.i=e.index_.toString()),t}class si extends Gt{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=ct("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return void 0!==n?"tag$"+n:(t(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const r=si.getListenId_(e,n),o={};this.listens_[r]=o;const a=ni(e._queryParams);this.restRequest_(s+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(s,a,!1,n),S(this.listens_,r)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=si.getListenId_(e,t);delete this.listens_[n]}get(e){const t=ni(e._queryParams),n=e._path.toString(),i=new p;return this.restRequest_(n+".json",t,((e,t)=>{let s=t;404===e&&(s=null,e=null),null===e?(this.onDataUpdate_(n,s,!1,null),i.resolve(s)):i.reject(new Error(s))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+O(t);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=C(o.responseText)}catch(e){ut("Failed to parse JSON response for "+r+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&ut("Got unsuccessful REST response for "+r+" Status: "+o.status),n(o.status);n=null}},o.open("GET",r,!0),o.send()}))}}class ri{constructor(){this.rootNode_=Bn.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function oi(){return{value:null,children:new Map}}function ai(e,t,n){if(an(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=Zt(t);e.children.has(i)||e.children.set(i,oi()),ai(e.children.get(i),t=tn(t),n)}}function ci(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{ci(i,new Qt(t.toString()+"/"+e),n)}))}class li{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&wt(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class hi{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new li(e);const n=1e4+2e4*Math.random();Et(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;wt(e,((e,i)=>{i>0&&k(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),Et(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var ui;function di(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(ui||(ui={}));class pi{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=ui.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(an(this.path)){if(null!=this.affectedTree.value)return t(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Qt(e));return new pi(Xt(),t,this.revert)}}return t(Zt(this.path)===e,"operationForChild called for unrelated child."),new pi(tn(this.path),this.affectedTree,this.revert)}}class fi{constructor(e,t){this.source=e,this.path=t,this.type=ui.LISTEN_COMPLETE}operationForChild(e){return an(this.path)?new fi(this.source,Xt()):new fi(this.source,tn(this.path))}}class _i{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=ui.OVERWRITE}operationForChild(e){return an(this.path)?new _i(this.source,Xt(),this.snap.getImmediateChild(e)):new _i(this.source,tn(this.path),this.snap)}}class mi{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=ui.MERGE}operationForChild(e){if(an(this.path)){const t=this.children.subtree(new Qt(e));return t.isEmpty()?null:t.value?new _i(this.source,Xt(),t.value):new mi(this.source,Xt(),t)}return t(Zt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new mi(this.source,tn(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class gi{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(an(e))return this.isFullyInitialized()&&!this.filtered_;const t=Zt(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class yi{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function vi(e,t,i,s,r,o){const a=s.filter((e=>e.type===i));a.sort(((t,i)=>function(e,t,i){if(null==t.childName||null==i.childName)throw n("Should only compare child_ events.");const s=new gn(t.childName,t.snapshotNode),r=new gn(i.childName,i.snapshotNode);return e.index_.compare(s,r)}(e,t,i))),a.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);r.forEach((s=>{s.respondsTo(n.type)&&t.push(s.createEvent(i,e.query_))}))}))}function wi(e,t){return{eventCache:e,serverCache:t}}function Ii(e,t,n,i){return wi(new gi(t,n,i),e.serverCache)}function bi(e,t,n,i){return wi(e.eventCache,new gi(t,n,i))}function Ci(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Ti(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Ei;class ki{constructor(e,t=(()=>(Ei||(Ei=new Tn(mt)),Ei))()){this.value=e,this.children=t}static fromObject(e){let t=new ki(null);return wt(e,((e,n)=>{t=t.set(new Qt(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Xt(),value:this.value};if(an(e))return null;{const n=Zt(e),i=this.children.get(n);if(null!==i){const s=i.findRootMostMatchingPathAndValue(tn(e),t);return null!=s?{path:on(new Qt(n),s.path),value:s.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(an(e))return this;{const t=Zt(e),n=this.children.get(t);return null!==n?n.subtree(tn(e)):new ki(null)}}set(e,t){if(an(e))return new ki(t,this.children);{const n=Zt(e),i=(this.children.get(n)||new ki(null)).set(tn(e),t),s=this.children.insert(n,i);return new ki(this.value,s)}}remove(e){if(an(e))return this.children.isEmpty()?new ki(null):new ki(null,this.children);{const t=Zt(e),n=this.children.get(t);if(n){const i=n.remove(tn(e));let s;return s=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&s.isEmpty()?new ki(null):new ki(this.value,s)}return this}}get(e){if(an(e))return this.value;{const t=Zt(e),n=this.children.get(t);return n?n.get(tn(e)):null}}setTree(e,t){if(an(e))return t;{const n=Zt(e),i=(this.children.get(n)||new ki(null)).setTree(tn(e),t);let s;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new ki(this.value,s)}}fold(e){return this.fold_(Xt(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,s)=>{n[i]=s.fold_(on(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Xt(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(an(e))return null;{const i=Zt(e),s=this.children.get(i);return s?s.findOnPath_(tn(e),on(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Xt(),t)}foreachOnPath_(e,t,n){if(an(e))return this;{this.value&&n(t,this.value);const i=Zt(e),s=this.children.get(i);return s?s.foreachOnPath_(tn(e),on(t,i),n):new ki(null)}}foreach(e){this.foreach_(Xt(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(on(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class Si{constructor(e){this.writeTree_=e}static empty(){return new Si(new ki(null))}}function Ni(e,t,n){if(an(t))return new Si(new ki(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const s=i.path;let r=i.value;const o=cn(s,t);return r=r.updateChild(o,n),new Si(e.writeTree_.set(s,r))}{const i=new ki(n),s=e.writeTree_.setTree(t,i);return new Si(s)}}}function Pi(e,t,n){let i=e;return wt(n,((e,n)=>{i=Ni(i,on(t,e),n)})),i}function Ri(e,t){if(an(t))return Si.empty();{const n=e.writeTree_.setTree(t,new ki(null));return new Si(n)}}function Di(e,t){return null!=Oi(e,t)}function Oi(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(cn(n.path,t)):null}function Ai(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(xn,((e,n)=>{t.push(new gn(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new gn(e,n.value))})),t}function xi(e,t){if(an(t))return e;{const n=Oi(e,t);return new Si(null!=n?new ki(n):e.writeTree_.subtree(t))}}function Mi(e){return e.writeTree_.isEmpty()}function Li(e,t){return Fi(Xt(),e.writeTree_,t)}function Fi(e,n,i){if(null!=n.value)return i.updateChild(e,n.value);{let s=null;return n.children.inorderTraversal(((n,r)=>{".priority"===n?(t(null!==r.value,"Priority writes must always be leaf nodes"),s=r.value):i=Fi(on(e,n),r,i)})),i.getChild(e).isEmpty()||null===s||(i=i.updateChild(on(e,".priority"),s)),i}}function Ui(e,t){return Yi(t,e)}function qi(e,t){if(e.snap)return hn(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&hn(on(e.path,n),t))return!0;return!1}function ji(e){return e.visible}function Wi(e,t,i){let s=Si.empty();for(let r=0;r<e.length;++r){const o=e[r];if(t(o)){const e=o.path;let t;if(o.snap)hn(i,e)?(t=cn(i,e),s=Ni(s,t,o.snap)):hn(e,i)&&(t=cn(e,i),s=Ni(s,Xt(),o.snap.getChild(t)));else{if(!o.children)throw n("WriteRecord should have .snap or .children");if(hn(i,e))t=cn(i,e),s=Pi(s,t,o.children);else if(hn(e,i))if(t=cn(e,i),an(t))s=Pi(s,Xt(),o.children);else{const e=S(o.children,Zt(t));if(e){const n=e.getChild(tn(t));s=Ni(s,Xt(),n)}}}}}return s}function Bi(e,t,n,i,s){if(i||s){const r=xi(e.visibleWrites,t);if(!s&&Mi(r))return n;if(s||null!=n||Di(r,Xt())){const r=function(e){return(e.visible||s)&&(!i||!~i.indexOf(e.writeId))&&(hn(e.path,t)||hn(t,e.path))};return Li(Wi(e.allWrites,r,t),n||Bn.EMPTY_NODE)}return null}{const i=Oi(e.visibleWrites,t);if(null!=i)return i;{const i=xi(e.visibleWrites,t);return Mi(i)?n:null!=n||Di(i,Xt())?Li(i,n||Bn.EMPTY_NODE):null}}}function Vi(e,t,n,i){return Bi(e.writeTree,e.treePath,t,n,i)}function Hi(e,t){return function(e,t,n){let i=Bn.EMPTY_NODE;const s=Oi(e.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(xn,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const s=xi(e.visibleWrites,t);return n.forEachChild(xn,((e,t)=>{const n=Li(xi(s,new Qt(e)),t);i=i.updateImmediateChild(e,n)})),Ai(s).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return Ai(xi(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function zi(e,n,i,s){return function(e,n,i,s,r){t(s||r,"Either existingEventSnap or existingServerSnap must exist");const o=on(n,i);if(Di(e.visibleWrites,o))return null;{const t=xi(e.visibleWrites,o);return Mi(t)?r.getChild(i):Li(t,r.getChild(i))}}(e.writeTree,e.treePath,n,i,s)}function $i(e,t){return function(e,t){return Oi(e.visibleWrites,t)}(e.writeTree,on(e.treePath,t))}function Ki(e,t,n){return function(e,t,n,i){const s=on(t,n),r=Oi(e.visibleWrites,s);return null!=r?r:i.isCompleteForChild(n)?Li(xi(e.visibleWrites,s),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Gi(e,t){return Yi(on(e.treePath,t),e.writeTree)}function Yi(e,t){return{treePath:e,writeTree:t}}class Ji{constructor(){this.changeMap=new Map}trackChildChange(e){const i=e.type,s=e.childName;t("child_added"===i||"child_changed"===i||"child_removed"===i,"Only child changes supported for tracking"),t(".priority"!==s,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const t=r.type;if("child_added"===i&&"child_removed"===t)this.changeMap.set(s,Qn(s,e.snapshotNode,r.snapshotNode));else if("child_removed"===i&&"child_added"===t)this.changeMap.delete(s);else if("child_removed"===i&&"child_changed"===t)this.changeMap.set(s,Jn(s,r.oldSnap));else if("child_changed"===i&&"child_added"===t)this.changeMap.set(s,Yn(s,e.snapshotNode));else{if("child_changed"!==i||"child_changed"!==t)throw n("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(s,Qn(s,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}const Qi=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Xi{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new gi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ki(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Ti(this.viewCache_),s=function(e,t,n,i,s,r){return function(e,t,n,i,s,r,o){let a;const c=xi(e.visibleWrites,t),l=Oi(c,Xt());if(null!=l)a=l;else{if(null==n)return[];a=Li(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&e.length<s;)0!==t(c,i)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,s,r)}(this.writes_,i,t,1,n,e);return 0===s.length?null:s[0]}}function Zi(e,n,i,s,r,o){const a=n.eventCache;if(null!=$i(s,i))return n;{let c,l;if(an(i))if(t(n.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),n.serverCache.isFiltered()){const t=Ti(n),i=Hi(s,t instanceof Bn?t:Bn.EMPTY_NODE);c=e.filter.updateFullNode(n.eventCache.getNode(),i,o)}else{const t=Vi(s,Ti(n));c=e.filter.updateFullNode(n.eventCache.getNode(),t,o)}else{const h=Zt(i);if(".priority"===h){t(1===en(i),"Can't have a priority with additional path components");const r=a.getNode();l=n.serverCache.getNode();const o=zi(s,i,r,l);c=null!=o?e.filter.updatePriority(r,o):a.getNode()}else{const t=tn(i);let u;if(a.isCompleteForChild(h)){l=n.serverCache.getNode();const e=zi(s,i,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(h).updateChild(t,e):a.getNode().getImmediateChild(h)}else u=Ki(s,h,n.serverCache);c=null!=u?e.filter.updateChild(a.getNode(),h,u,t,r,o):a.getNode()}}return Ii(n,c,a.isFullyInitialized()||an(i),e.filter.filtersNodes())}}function es(e,t,n,i,s,r,o,a){const c=t.serverCache;let l;const h=o?e.filter:e.filter.getIndexedFilter();if(an(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),e,null)}else{const e=Zt(n);if(!c.isCompleteForPath(n)&&en(n)>1)return t;const s=tn(n),r=c.getNode().getImmediateChild(e).updateChild(s,i);l=".priority"===e?h.updatePriority(c.getNode(),r):h.updateChild(c.getNode(),e,r,s,Qi,null)}const u=bi(t,l,c.isFullyInitialized()||an(n),h.filtersNodes());return Zi(e,u,n,s,new Xi(s,u,r),a)}function ts(e,t,n,i,s,r,o){const a=t.eventCache;let c,l;const h=new Xi(s,t,r);if(an(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),c=Ii(t,l,!0,e.filter.filtersNodes());else{const s=Zt(n);if(".priority"===s)l=e.filter.updatePriority(t.eventCache.getNode(),i),c=Ii(t,l,a.isFullyInitialized(),a.isFiltered());else{const r=tn(n),l=a.getNode().getImmediateChild(s);let u;if(an(r))u=i;else{const e=h.getCompleteChild(s);u=null!=e?".priority"===nn(r)&&e.getChild(rn(r)).isEmpty()?e:e.updateChild(r,i):Bn.EMPTY_NODE}c=l.equals(u)?t:Ii(t,e.filter.updateChild(a.getNode(),s,u,r,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function ns(e,t){return e.eventCache.isCompleteForChild(t)}function is(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function ss(e,t,n,i,s,r,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=an(n)?i:new ki(null).setTree(n,i);const h=t.serverCache.getNode();return c.children.inorderTraversal(((n,i)=>{if(h.hasChild(n)){const c=is(0,t.serverCache.getNode().getImmediateChild(n),i);l=es(e,l,new Qt(n),c,s,r,o,a)}})),c.children.inorderTraversal(((n,i)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!h.hasChild(n)&&!c){const c=is(0,t.serverCache.getNode().getImmediateChild(n),i);l=es(e,l,new Qt(n),c,s,r,o,a)}})),l}class rs{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new Xn(n.getIndex()),s=(r=n).loadsAllData()?new Xn(r.getIndex()):r.hasLimit()?new ei(r):new Zn(r);var r;this.processor_=function(e){return{filter:e}}(s);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(Bn.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(Bn.EMPTY_NODE,a.getNode(),null),h=new gi(c,o.isFullyInitialized(),i.filtersNodes()),u=new gi(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=wi(u,h),this.eventGenerator_=new yi(this.query_)}get query(){return this.query_}}function os(e,t){const n=Ti(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!an(t)&&!n.getImmediateChild(Zt(t)).isEmpty())?n.getChild(t):null}function as(e){return 0===e.eventRegistrations_.length}function cs(e,n,i){const s=[];if(i){t(null==n,"A cancel should cancel all event registrations.");const r=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(i,r);t&&s.push(t)}))}if(n){let t=[];for(let i=0;i<e.eventRegistrations_.length;++i){const s=e.eventRegistrations_[i];if(s.matches(n)){if(n.hasAnyCallback()){t=t.concat(e.eventRegistrations_.slice(i+1));break}}else t.push(s)}e.eventRegistrations_=t}else e.eventRegistrations_=[];return s}function ls(e,i,s,r){i.type===ui.MERGE&&null!==i.source.queryId&&(t(Ti(e.viewCache_),"We should always have a full cache before handling merges"),t(Ci(e.viewCache_),"Missing event cache, even though we have a server cache"));const o=e.viewCache_,a=function(e,i,s,r,o){const a=new Ji;let c,l;if(s.type===ui.OVERWRITE){const n=s;n.source.fromUser?c=ts(e,i,n.path,n.snap,r,o,a):(t(n.source.fromServer,"Unknown source."),l=n.source.tagged||i.serverCache.isFiltered()&&!an(n.path),c=es(e,i,n.path,n.snap,r,o,l,a))}else if(s.type===ui.MERGE){const n=s;n.source.fromUser?c=function(e,t,n,i,s,r,o){let a=t;return i.foreach(((i,c)=>{const l=on(n,i);ns(t,Zt(l))&&(a=ts(e,a,l,c,s,r,o))})),i.foreach(((i,c)=>{const l=on(n,i);ns(t,Zt(l))||(a=ts(e,a,l,c,s,r,o))})),a}(e,i,n.path,n.children,r,o,a):(t(n.source.fromServer,"Unknown source."),l=n.source.tagged||i.serverCache.isFiltered(),c=ss(e,i,n.path,n.children,r,o,l,a))}else if(s.type===ui.ACK_USER_WRITE){const n=s;c=n.revert?function(e,n,i,s,r,o){let a;if(null!=$i(s,i))return n;{const c=new Xi(s,n,r),l=n.eventCache.getNode();let h;if(an(i)||".priority"===Zt(i)){let i;if(n.serverCache.isFullyInitialized())i=Vi(s,Ti(n));else{const e=n.serverCache.getNode();t(e instanceof Bn,"serverChildren would be complete if leaf node"),i=Hi(s,e)}h=e.filter.updateFullNode(l,i,o)}else{const t=Zt(i);let r=Ki(s,t,n.serverCache);null==r&&n.serverCache.isCompleteForChild(t)&&(r=l.getImmediateChild(t)),h=null!=r?e.filter.updateChild(l,t,r,tn(i),c,o):n.eventCache.getNode().hasChild(t)?e.filter.updateChild(l,t,Bn.EMPTY_NODE,tn(i),c,o):l,h.isEmpty()&&n.serverCache.isFullyInitialized()&&(a=Vi(s,Ti(n)),a.isLeafNode()&&(h=e.filter.updateFullNode(h,a,o)))}return a=n.serverCache.isFullyInitialized()||null!=$i(s,Xt()),Ii(n,h,a,e.filter.filtersNodes())}}(e,i,n.path,r,o,a):function(e,t,n,i,s,r,o){if(null!=$i(s,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(an(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return es(e,t,n,c.getNode().getChild(n),s,r,a,o);if(an(n)){let i=new ki(null);return c.getNode().forEachChild(In,((e,t)=>{i=i.set(new Qt(e),t)})),ss(e,t,n,i,s,r,a,o)}return t}{let l=new ki(null);return i.foreach(((e,t)=>{const i=on(n,e);c.isCompleteForPath(i)&&(l=l.set(e,c.getNode().getChild(i)))})),ss(e,t,n,l,s,r,a,o)}}(e,i,n.path,n.affectedTree,r,o,a)}else{if(s.type!==ui.LISTEN_COMPLETE)throw n("Unknown operation type: "+s.type);c=function(e,t,n,i,s){const r=t.serverCache;return Zi(e,bi(t,r.getNode(),r.isFullyInitialized()||an(n),r.isFiltered()),n,i,Qi,s)}(e,i,s.path,r,a)}const h=a.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Ci(e);(n.length>0||!e.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(Gn(Ci(t)))}}(i,c,h),{viewCache:c,changes:h}}(e.processor_,o,i,s,r);var c,l;return c=e.processor_,l=a.viewCache,t(l.eventCache.getNode().isIndexed(c.filter.getIndex()),"Event snap not indexed"),t(l.serverCache.getNode().isIndexed(c.filter.getIndex()),"Server snap not indexed"),t(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,hs(e,a.changes,a.viewCache.eventCache.getNode(),null)}function hs(e,t,n,i){const s=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const s=[],r=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&r.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),vi(e,s,"child_removed",t,i,n),vi(e,s,"child_added",t,i,n),vi(e,s,"child_moved",r,i,n),vi(e,s,"child_changed",t,i,n),vi(e,s,"value",t,i,n),s}(e.eventGenerator_,t,n,s)}let us,ds;class ps{constructor(){this.views=new Map}}function fs(e,n,i,s){const r=n.source.queryId;if(null!==r){const o=e.views.get(r);return t(null!=o,"SyncTree gave us an op for an invalid query."),ls(o,n,i,s)}{let t=[];for(const r of e.views.values())t=t.concat(ls(r,n,i,s));return t}}function _s(e,t,n,i,s){const r=t._queryIdentifier,o=e.views.get(r);if(!o){let e=Vi(n,s?i:null),r=!1;e?r=!0:i instanceof Bn?(e=Hi(n,i),r=!1):(e=Bn.EMPTY_NODE,r=!1);const o=wi(new gi(e,r,!1),new gi(i,s,!1));return new rs(t,o)}return o}function ms(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function gs(e,t){let n=null;for(const i of e.views.values())n=n||os(i,t);return n}function ys(e,t){if(t._queryParams.loadsAllData())return Is(e);{const n=t._queryIdentifier;return e.views.get(n)}}function vs(e,t){return null!=ys(e,t)}function ws(e){return null!=Is(e)}function Is(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let bs=1;class Cs{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ki(null),this.pendingWriteTree_={visibleWrites:Si.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Ts(e,n,i,s,r){return function(e,n,i,s,r){t(s>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:n,snap:i,writeId:s,visible:r}),r&&(e.visibleWrites=Ni(e.visibleWrites,n,i)),e.lastWriteId=s}(e.pendingWriteTree_,n,i,s,r),r?Ds(e,new _i({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},n,i)):[]}function Es(e,n,i=!1){const s=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,n);if(function(e,n){const i=e.allWrites.findIndex((e=>e.writeId===n));t(i>=0,"removeWrite called with nonexistent writeId.");const s=e.allWrites[i];e.allWrites.splice(i,1);let r=s.visible,o=!1,a=e.allWrites.length-1;for(;r&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=i&&qi(t,s.path)?r=!1:hn(s.path,t.path)&&(o=!0)),a--}return!!r&&(o?(function(e){e.visibleWrites=Wi(e.allWrites,ji,Xt()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(s.snap?e.visibleWrites=Ri(e.visibleWrites,s.path):wt(s.children,(t=>{e.visibleWrites=Ri(e.visibleWrites,on(s.path,t))})),!0))}(e.pendingWriteTree_,n)){let t=new ki(null);return null!=s.snap?t=t.set(Xt(),!0):wt(s.children,(e=>{t=t.set(new Qt(e),!0)})),Ds(e,new pi(s.path,t,i))}return[]}function ks(e,t,n){return Ds(e,new _i({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Ss(e,n,i,s,r=!1){const o=n._path,a=e.syncPointTree_.get(o);let c=[];if(a&&("default"===n._queryIdentifier||vs(a,n))){const l=function(e,n,i,s){const r=n._queryIdentifier,o=[];let a=[];const c=ws(e);if("default"===r)for(const[t,n]of e.views.entries())a=a.concat(cs(n,i,s)),as(n)&&(e.views.delete(t),n.query._queryParams.loadsAllData()||o.push(n.query));else{const t=e.views.get(r);t&&(a=a.concat(cs(t,i,s)),as(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||o.push(t.query)))}return c&&!ws(e)&&o.push(new(t(us,"Reference.ts has not been loaded"),us)(n._repo,n._path)),{removed:o,events:a}}(a,n,i,s);0===a.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(o));const h=l.removed;if(c=l.events,!r){const t=-1!==h.findIndex((e=>e._queryParams.loadsAllData())),i=e.syncPointTree_.findOnPath(o,((e,t)=>ws(t)));if(t&&!i){const t=e.syncPointTree_.subtree(o);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&ws(t))return[Is(t)];{let e=[];return t&&(e=ms(t)),wt(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const i=n[t],s=i.query,r=xs(e,i);e.listenProvider_.startListening(js(s),Ms(e,s),r.hashFn,r.onComplete)}}}if(!i&&h.length>0&&!s)if(t){const t=null;e.listenProvider_.stopListening(js(n),t)}else h.forEach((t=>{const n=e.queryToTagMap.get(Ls(t));e.listenProvider_.stopListening(js(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=Ls(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,h)}return c}function Ns(e,t,n,i){const s=Fs(e,i);if(null!=s){const i=Us(s),r=i.path,o=i.queryId,a=cn(r,t);return qs(e,r,new _i(di(o),a,n))}return[]}function Ps(e,n,i,s=!1){const r=n._path;let o=null,a=!1;e.syncPointTree_.foreachOnPath(r,((e,t)=>{const n=cn(e,r);o=o||gs(t,n),a=a||ws(t)}));let c,l=e.syncPointTree_.get(r);l?(a=a||ws(l),o=o||gs(l,Xt())):(l=new ps,e.syncPointTree_=e.syncPointTree_.set(r,l)),null!=o?c=!0:(c=!1,o=Bn.EMPTY_NODE,e.syncPointTree_.subtree(r).foreachChild(((e,t)=>{const n=gs(t,Xt());n&&(o=o.updateImmediateChild(e,n))})));const h=vs(l,n);if(!h&&!n._queryParams.loadsAllData()){const i=Ls(n);t(!e.queryToTagMap.has(i),"View does not exist, but we have a tag");const s=bs++;e.queryToTagMap.set(i,s),e.tagToQueryMap.set(s,i)}let u=function(e,t,n,i,s,r){const o=_s(e,t,i,s,r);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(xn,((e,t)=>{i.push(Yn(e,t))})),n.isFullyInitialized()&&i.push(Gn(n.getNode())),hs(e,i,n.getNode(),t)}(o,n)}(l,n,i,Ui(e.pendingWriteTree_,r),o,c);if(!h&&!a&&!s){const i=ys(l,n);u=u.concat(function(e,n,i){const s=n._path,r=Ms(e,n),o=xs(e,i),a=e.listenProvider_.startListening(js(n),r,o.hashFn,o.onComplete),c=e.syncPointTree_.subtree(s);if(r)t(!ws(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold(((e,t,n)=>{if(!an(e)&&t&&ws(t))return[Is(t).query];{let e=[];return t&&(e=e.concat(ms(t).map((e=>e.query)))),wt(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(js(i),Ms(e,i))}}return a}(e,n,i))}return u}function Rs(e,t,n){const i=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=gs(n,cn(e,t));if(i)return i}));return Bi(i,t,s,n,!0)}function Ds(e,t){return Os(t,e.syncPointTree_,null,Ui(e.pendingWriteTree_,Xt()))}function Os(e,t,n,i){if(an(e.path))return As(e,t,n,i);{const s=t.get(Xt());null==n&&null!=s&&(n=gs(s,Xt()));let r=[];const o=Zt(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=Gi(i,o);r=r.concat(Os(a,c,e,t))}return s&&(r=r.concat(fs(s,e,i,n))),r}}function As(e,t,n,i){const s=t.get(Xt());null==n&&null!=s&&(n=gs(s,Xt()));let r=[];return t.children.inorderTraversal(((t,s)=>{const o=n?n.getImmediateChild(t):null,a=Gi(i,t),c=e.operationForChild(t);c&&(r=r.concat(As(c,s,o,a)))})),s&&(r=r.concat(fs(s,e,i,n))),r}function xs(e,t){const n=t.query,i=Ms(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Bn.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=Fs(e,n);if(i){const n=Us(i),s=n.path,r=n.queryId,o=cn(s,t);return qs(e,s,new fi(di(r),o))}return[]}(e,n._path,i):function(e,t){return Ds(e,new fi({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return Ss(e,n,null,i)}}}}function Ms(e,t){const n=Ls(t);return e.queryToTagMap.get(n)}function Ls(e){return e._path.toString()+"$"+e._queryIdentifier}function Fs(e,t){return e.tagToQueryMap.get(t)}function Us(e){const n=e.indexOf("$");return t(-1!==n&&n<e.length-1,"Bad queryKey."),{queryId:e.substr(n+1),path:new Qt(e.substr(0,n))}}function qs(e,n,i){const s=e.syncPointTree_.get(n);return t(s,"Missing sync point for query tag that we're tracking"),fs(s,i,Ui(e.pendingWriteTree_,n),null)}function js(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(t(ds,"Reference.ts has not been loaded"),ds)(e._repo,e._path):e}class Ws{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Ws(t)}node(){return this.node_}}class Bs{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=on(this.path_,e);return new Bs(this.syncTree_,t)}node(){return Rs(this.syncTree_,this.path_)}}const Vs=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},Hs=function(e,n,i){return e&&"object"==typeof e?(t(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?zs(e[".sv"],n,i):"object"==typeof e[".sv"]?$s(e[".sv"],n):void t(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},zs=function(e,n,i){if("timestamp"===e)return i.timestamp;t(!1,"Unexpected server value: "+e)},$s=function(e,n,i){e.hasOwnProperty("increment")||t(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const s=e.increment;"number"!=typeof s&&t(!1,"Unexpected increment value: "+s);const r=n.node();if(t(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return"number"!=typeof o?s:o+s},Ks=function(e,t,n,i){return Ys(t,new Bs(n,e),i)},Gs=function(e,t,n){return Ys(e,new Ws(t),n)};function Ys(e,t,n){const i=e.getPriority().val(),s=Hs(i,t.getImmediateChild(".priority"),n);let r;if(e.isLeafNode()){const i=e,r=Hs(i.getValue(),t,n);return r!==i.getValue()||s!==i.getPriority().val()?new An(r,zn(s)):e}{const i=e;return r=i,s!==i.getPriority().val()&&(r=r.updatePriority(new An(s))),i.forEachChild(xn,((e,i)=>{const s=Ys(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))})),r}}class Js{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Qs(e,t){let n=t instanceof Qt?t:new Qt(t),i=e,s=Zt(n);for(;null!==s;){const e=S(i.node.children,s)||{children:{},childCount:0};i=new Js(s,i,e),n=tn(n),s=Zt(n)}return i}function Xs(e){return e.node.value}function Zs(e,t){e.node.value=t,sr(e)}function er(e){return e.node.childCount>0}function tr(e,t){wt(e.node.children,((n,i)=>{t(new Js(n,e,i))}))}function nr(e,t,n,i){n&&!i&&t(e),tr(e,(e=>{nr(e,t,!0,i)})),n&&i&&t(e)}function ir(e){return new Qt(null===e.parent?e.name:ir(e.parent)+"/"+e.name)}function sr(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===Xs(e)&&!er(e)}(n),s=k(e.node.children,t);i&&s?(delete e.node.children[t],e.node.childCount--,sr(e)):i||s||(e.node.children[t]=n.node,e.node.childCount++,sr(e))}(e.parent,e.name,e)}const rr=/[\[\].#$\/\u0000-\u001F\u007F]/,or=/[\[\].#$\u0000-\u001F\u007F]/,ar=10485760,cr=function(e){return"string"==typeof e&&0!==e.length&&!rr.test(e)},lr=function(e){return"string"==typeof e&&0!==e.length&&!or.test(e)},hr=function(e,t,n){const i=n instanceof Qt?new un(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+pn(i));if("function"==typeof t)throw new Error(e+"contains a function "+pn(i)+" with contents = "+t.toString());if(dt(t))throw new Error(e+"contains "+t.toString()+" "+pn(i));if("string"==typeof t&&t.length>ar/3&&q(t)>ar)throw new Error(e+"contains a string greater than "+ar+" utf8 bytes "+pn(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,s=!1;if(wt(t,((t,r)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!cr(t)))throw new Error(e+" contains an invalid key ("+t+") "+pn(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=q(t),dn(e)}(i,t),hr(e,r,i),function(e){const t=e.parts_.pop();e.byteLength_-=q(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&s)throw new Error(e+' contains ".value" child '+pn(i)+" in addition to actual children.")}},ur=function(e,t,n,i){if(!(i&&void 0===n||lr(n)))throw new Error(U(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},dr=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ur(e,t,n,i)};class pr{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function fr(e,t,n){(function(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i],r=s.getPath();null===n||ln(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)})(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const s=e.eventLists_[i];s&&(t(s.path)?(_r(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,(e=>hn(e,t)||hn(t,e)))}function _r(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();rt&&at("event: "+n.toString()),Tt(i)}}}const mr=25;class gr{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new pr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=oi(),this.transactionQueueTree_=new Js,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function yr(e,t,n){if(e.stats_=qt(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new si(e.repoInfo_,((t,n,i,s)=>{Ir(e,t,n,i,s)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>br(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{T(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new mn(e.repoInfo_,t,((t,n,i,s)=>{Ir(e,t,n,i,s)}),(t=>{br(e,t)}),(t=>{!function(e,t){wt(t,((t,n)=>{Cr(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(t,n){const i=t.toString();return Ut[i]||(Ut[i]=new hi(e.stats_,e.server_)),Ut[i]}(e.repoInfo_),e.infoData_=new ri,e.infoSyncTree_=new Cs({startListening:(t,n,i,s)=>{let r=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(r=ks(e.infoSyncTree_,t._path,o),setTimeout((()=>{s("ok")}),0)),r},stopListening:()=>{}}),Cr(e,"connected",!1),e.serverSyncTree_=new Cs({startListening:(t,n,i,s)=>(e.server_.listen(t,i,n,((n,i)=>{const r=s(n,i);fr(e.eventQueue_,t._path,r)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function vr(e){const t=e.infoData_.getNode(new Qt(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function wr(e){return Vs({timestamp:vr(e)})}function Ir(e,t,n,i,s){e.dataUpdateCount++;const r=new Qt(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(s)if(i){const t=P(n,(e=>zn(e)));o=function(e,t,n,i){const s=Fs(e,i);if(s){const i=Us(s),r=i.path,o=i.queryId,a=cn(r,t),c=ki.fromObject(n);return qs(e,r,new mi(di(o),a,c))}return[]}(e.serverSyncTree_,r,t,s)}else{const t=zn(n);o=Ns(e.serverSyncTree_,r,t,s)}else if(i){const t=P(n,(e=>zn(e)));o=function(e,t,n){const i=ki.fromObject(n);return Ds(e,new mi({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,r,t)}else{const t=zn(n);o=ks(e.serverSyncTree_,r,t)}let a=r;o.length>0&&(a=Nr(e,r)),fr(e.eventQueue_,a,o)}function br(e,t){Cr(e,"connected",t),!1===t&&function(e){Er(e,"onDisconnectEvents");const t=wr(e),n=oi();ci(e.onDisconnect_,Xt(),((i,s)=>{const r=Ks(i,s,e.serverSyncTree_,t);ai(n,i,r)}));let i=[];ci(n,Xt(),((t,n)=>{i=i.concat(ks(e.serverSyncTree_,t,n));const s=function(e,t){const n=ir(Pr(e,t)),i=Qs(e.transactionQueueTree_,t);return function(e,t,n){let i=void 0?e:e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,(t=>{Ar(e,t)})),Ar(e,i),nr(i,(t=>{Ar(e,t)})),n}(e,t);Nr(e,s)})),e.onDisconnect_=oi(),fr(e.eventQueue_,Xt(),i)}(e)}function Cr(e,t,n){const i=new Qt("/.info/"+t),s=zn(n);e.infoData_.updateSnapshot(i,s);const r=ks(e.infoSyncTree_,i,s);fr(e.eventQueue_,i,r)}function Tr(e){return e.nextWriteId_++}function Er(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),at(n,...t)}function kr(e,t,n){return Rs(e.serverSyncTree_,t,n)||Bn.EMPTY_NODE}function Sr(e,n=e.transactionQueueTree_){if(n||Or(e,n),Xs(n)){const i=Rr(e,n);t(i.length>0,"Sending zero length transaction queue"),i.every((e=>0===e.status))&&function(e,n,i){const s=i.map((e=>e.currentWriteId)),r=kr(e,n,s);let o=r;const a=r.hash();for(let e=0;e<i.length;e++){const s=i[e];t(0===s.status,"tryToSendTransactionQueue_: items in queue should all be run."),s.status=1,s.retryCount++;const r=cn(n,s.path);o=o.updateChild(r,s.currentOutputSnapshotRaw)}const c=o.val(!0),l=n;e.server_.put(l.toString(),c,(t=>{Er(e,"transaction put response",{path:l.toString(),status:t});let s=[];if("ok"===t){const t=[];for(let n=0;n<i.length;n++)i[n].status=2,s=s.concat(Es(e.serverSyncTree_,i[n].currentWriteId)),i[n].onComplete&&t.push((()=>i[n].onComplete(null,!0,i[n].currentOutputSnapshotResolved))),i[n].unwatcher();Or(e,Qs(e.transactionQueueTree_,n)),Sr(e,e.transactionQueueTree_),fr(e.eventQueue_,n,s);for(let e=0;e<t.length;e++)Tt(t[e])}else{if("datastale"===t)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{ut("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=t}Nr(e,n)}}),a)}(e,ir(n),i)}else er(n)&&tr(n,(t=>{Sr(e,t)}))}function Nr(e,n){const i=Pr(e,n),s=ir(i);return function(e,n,i){if(0===n.length)return;const s=[];let r=[];const o=n.filter((e=>0===e.status)).map((e=>e.currentWriteId));for(let c=0;c<n.length;c++){const l=n[c],h=cn(i,l.path);let u,d=!1;if(t(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,r=r.concat(Es(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=mr)d=!0,u="maxretry",r=r.concat(Es(e.serverSyncTree_,l.currentWriteId,!0));else{const t=kr(e,l.path,o);l.currentInputSnapshot=t;const i=n[c].update(t.val());if(void 0!==i){hr("transaction failed: Data returned ",i,l.path);let n=zn(i);"object"==typeof i&&null!=i&&k(i,".priority")||(n=n.updatePriority(t.getPriority()));const s=l.currentWriteId,a=wr(e),c=Gs(n,t,a);l.currentOutputSnapshotRaw=n,l.currentOutputSnapshotResolved=c,l.currentWriteId=Tr(e),o.splice(o.indexOf(s),1),r=r.concat(Ts(e.serverSyncTree_,l.path,c,l.currentWriteId,l.applyLocally)),r=r.concat(Es(e.serverSyncTree_,s,!0))}else d=!0,u="nodata",r=r.concat(Es(e.serverSyncTree_,l.currentWriteId,!0))}fr(e.eventQueue_,i,r),r=[],d&&(n[c].status=2,a=n[c].unwatcher,setTimeout(a,Math.floor(0)),n[c].onComplete&&("nodata"===u?s.push((()=>n[c].onComplete(null,!1,n[c].currentInputSnapshot))):s.push((()=>n[c].onComplete(new Error(u),!1,null)))))}var a;Or(e,e.transactionQueueTree_);for(let e=0;e<s.length;e++)Tt(s[e]);Sr(e,e.transactionQueueTree_)}(e,Rr(e,i),s),s}function Pr(e,t){let n,i=e.transactionQueueTree_;for(n=Zt(t);null!==n&&void 0===Xs(i);)i=Qs(i,n),n=Zt(t=tn(t));return i}function Rr(e,t){const n=[];return Dr(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function Dr(e,t,n){const i=Xs(t);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);tr(t,(t=>{Dr(e,t,n)}))}function Or(e,t){const n=Xs(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Zs(t,n.length>0?n:void 0)}tr(t,(t=>{Or(e,t)}))}function Ar(e,n){const i=Xs(n);if(i){const s=[];let r=[],o=-1;for(let n=0;n<i.length;n++)3===i[n].status||(1===i[n].status?(t(o===n-1,"All SENT items should be at beginning of queue."),o=n,i[n].status=3,i[n].abortReason="set"):(t(0===i[n].status,"Unexpected transaction status in abort"),i[n].unwatcher(),r=r.concat(Es(e.serverSyncTree_,i[n].currentWriteId,!0)),i[n].onComplete&&s.push(i[n].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Zs(n,void 0):i.length=o+1,fr(e.eventQueue_,ir(n),r);for(let e=0;e<s.length;e++)Tt(s[e])}}const xr=function(e,t){const n=Mr(e),i=n.namespace;"firebase.com"===n.domain&&ht(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||ht("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ut("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new xt(n.host,n.secure,i,s,t,"",i!==n.subdomain),path:new Qt(n.pathString)}},Mr=function(e){let t="",n="",i="",s="",r="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let h=e.indexOf("/");-1===h&&(h=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(h,u)),h<u&&(s=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(h,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):ut(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),r=i}"ns"in d&&(r=d.ns)}return{host:t,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};class Lr{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+T(this.snapshot.exportVal())}}class Fr{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Ur{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return t(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class qr{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return an(this._path)?null:nn(this._path)}get ref(){return new jr(this._repo,this._path)}get _queryIdentifier(){const e=ii(this._queryParams),t=yt(e);return"{}"===t?"default":t}get _queryObject(){return ii(this._queryParams)}isEqual(e){if(!((e=z(e))instanceof qr))return!1;const t=this._repo===e._repo,n=ln(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class jr extends qr{constructor(e,t){super(e,t,new ti,!1)}get parent(){const e=rn(this._path);return null===e?null:new jr(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Wr{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Qt(e),n=Br(this.ref,e);return new Wr(this._node.getChild(t),n,xn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,((t,n)=>e(new Wr(n,Br(this.ref,t),xn))))}hasChild(e){const t=new Qt(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Br(e,t){return null===Zt((e=z(e))._path)?dr("child","path",t,!1):ur("child","path",t,!1),new jr(e._repo,on(e._path,t))}class Vr{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new Lr("value",this,new Wr(e.snapshotNode,new jr(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Fr(this,e,t):null}matches(e){return e instanceof Vr&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}!function(e){t(!us,"__referenceConstructor has already been defined"),us=e}(jr),function(e){t(!ds,"__referenceConstructor has already been defined"),ds=e}(jr);const Hr={};function zr(e,t,n,i,s){let r=i||e.options.databaseURL;void 0===r&&(e.options.projectId||ht("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),at("Using default host for project ",e.options.projectId),r=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,c=xr(r,s),l=c.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,r=`http://${a}?ns=${l.namespace}`,c=xr(r,s),l=c.repoInfo):o=!c.repoInfo.secure;const h=s&&o?new Nt(Nt.OWNER):new St(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!cr(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),lr(e)}(n))throw new Error(U(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",c),an(c.path)||ht("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,i){let s=Hr[t.name];s||(s={},Hr[t.name]=s);let r=s[e.toURLString()];return r&&ht("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new gr(e,false,n,i),s[e.toURLString()]=r,r}(l,e,h,new kt(e.name,n));return new $r(u,e)}class $r{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(yr(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new jr(this._repo,Xt())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=Hr[t];n&&n[e.key]===e||ht(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&ht("Cannot call "+e+" on a deleted database.")}}mn.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},mn.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Ye=Ae,Pe(new $("database",((e,{instanceIdentifier:t})=>zr(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),Me(Ke,Ge,void 0),Me(Ke,Ge,"esm2017");const Kr=(e,t)=>t.some((t=>e instanceof t));let Gr,Yr;const Jr=new WeakMap,Qr=new WeakMap,Xr=new WeakMap,Zr=new WeakMap,eo=new WeakMap;let to={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Qr.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Xr.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return io(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function no(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Yr||(Yr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(so(this),e),io(Jr.get(this))}:function(...e){return io(t.apply(so(this),e))}:function(e,...n){const i=t.call(so(this),e,...n);return Xr.set(i,e.sort?e.sort():[e]),io(i)}:(e instanceof IDBTransaction&&function(e){if(Qr.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)}));Qr.set(e,t)}(e),Kr(e,Gr||(Gr=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,to):e);var t}function io(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(io(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&Jr.set(t,e)})).catch((()=>{})),eo.set(t,e),t}(e);if(Zr.has(e))return Zr.get(e);const t=no(e);return t!==e&&(Zr.set(e,t),eo.set(t,e)),t}const so=e=>eo.get(e),ro=["get","getKey","getAll","getAllKeys","count"],oo=["put","add","delete","clear"],ao=new Map;function co(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ao.get(t))return ao.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=oo.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!ro.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&r.done]))[0]};return ao.set(t,r),r}to=(e=>({...e,get:(t,n,i)=>co(t,n)||e.get(t,n,i),has:(t,n)=>!!co(t,n)||e.has(t,n)}))(to);const lo="@firebase/installations",ho="0.6.4",uo=1e4,po=`w:${ho}`,fo="FIS_v2",_o="https://firebaseinstallations.googleapis.com/v1",mo=36e5,go=new I("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function yo(e){return e instanceof w&&e.code.includes("request-failed")}function vo({projectId:e}){return`${_o}/projects/${e}/installations`}function wo(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Io(e,t){const n=(await t.json()).error;return go.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function bo({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Co(e){const t=await e();return t.status>=500&&t.status<600?e():t}function To(e){return new Promise((t=>{setTimeout(t,e)}))}const Eo=/^[cdef][\w-]{21}$/,ko="";function So(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return Eo.test(t)?t:ko}catch(e){return ko}}function No(e){return`${e.appName}!${e.appId}`}const Po=new Map;function Ro(e,t){const n=No(e);Do(n,t),function(e,t){const n=(!Oo&&"BroadcastChannel"in self&&(Oo=new BroadcastChannel("[Firebase] FID Change"),Oo.onmessage=e=>{Do(e.data.key,e.data.fid)}),Oo);n&&n.postMessage({key:e,fid:t}),0===Po.size&&Oo&&(Oo.close(),Oo=null)}(n,t)}function Do(e,t){const n=Po.get(e);if(n)for(const e of n)e(t)}let Oo=null;const Ao="firebase-installations-database",xo=1,Mo="firebase-installations-store";let Lo=null;function Fo(){return Lo||(Lo=function(e,t,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(e,t),a=io(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(io(o.result),e.oldVersion,e.newVersion,io(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{r&&e.addEventListener("close",(()=>r())),s&&e.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}(Ao,xo,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Mo)}})),Lo}async function Uo(e,t){const n=No(e),i=(await Fo()).transaction(Mo,"readwrite"),s=i.objectStore(Mo),r=await s.get(n);return await s.put(t,n),await i.done,r&&r.fid===t.fid||Ro(e,t.fid),t}async function qo(e){const t=No(e),n=(await Fo()).transaction(Mo,"readwrite");await n.objectStore(Mo).delete(t),await n.done}async function jo(e,t){const n=No(e),i=(await Fo()).transaction(Mo,"readwrite"),s=i.objectStore(Mo),r=await s.get(n),o=t(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||r&&r.fid===o.fid||Ro(e,o.fid),o}async function Wo(e){let t;const n=await jo(e.appConfig,(n=>{const i=function(e){return Ho(e||{fid:So(),registrationStatus:0})}(n),s=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(go.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=vo(e),s=bo(e),r=t.getImmediate({optional:!0});if(r){const e=await r.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}const o={fid:n,authVersion:fo,appId:e.appId,sdkVersion:po},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await Co((()=>fetch(i,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:wo(e.authToken)}}throw await Io("Create Installation",c)}(e,t);return Uo(e.appConfig,n)}catch(n){throw yo(n)&&409===n.customData.serverCode?await qo(e.appConfig):await Uo(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Bo(e)}:{installationEntry:t}}(e,i);return t=s.registrationPromise,s.installationEntry}));return n.fid===ko?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Bo(e){let t=await Vo(e.appConfig);for(;1===t.registrationStatus;)await To(100),t=await Vo(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await Wo(e);return n||t}return t}function Vo(e){return jo(e,(e=>{if(!e)throw go.create("installation-not-found");return Ho(e)}))}function Ho(e){return 1===(t=e).registrationStatus&&t.registrationTime+uo<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function zo({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${vo(e)}/${t}/authTokens:generate`}(e,n),s=function(e,{refreshToken:t}){const n=bo(e);return n.append("Authorization",function(e){return`${fo} ${e}`}(t)),n}(e,n),r=t.getImmediate({optional:!0});if(r){const e=await r.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}const o={installation:{sdkVersion:po,appId:e.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await Co((()=>fetch(i,a)));if(c.ok)return wo(await c.json());throw await Io("Generate Auth Token",c)}async function $o(e,t=!1){let n;const i=await jo(e.appConfig,(i=>{if(!Go(i))throw go.create("not-registered");const s=i.authToken;if(!t&&(2===(r=s).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+mo}(r)))return i;var r;if(1===s.requestStatus)return n=async function(e,t){let n=await Ko(e.appConfig);for(;1===n.authToken.requestStatus;)await To(100),n=await Ko(e.appConfig);const i=n.authToken;return 0===i.requestStatus?$o(e,t):i}(e,t),i;{if(!navigator.onLine)throw go.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await zo(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await Uo(e.appConfig,i),n}catch(n){if(!yo(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Uo(e.appConfig,n)}else await qo(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function Ko(e){return jo(e,(e=>{if(!Go(e))throw go.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+uo<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function Go(e){return void 0!==e&&2===e.registrationStatus}function Yo(e){return go.create("missing-app-config-values",{valueName:e})}const Jo="installations";Pe(new $(Jo,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Yo("App Configuration");if(!e.name)throw Yo("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Yo(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:Re(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Pe(new $("installations-internal",(e=>{const t=Re(e.getProvider("app").getImmediate(),Jo).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await Wo(t);return i?i.catch(console.error):$o(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await Wo(e);t&&await t}(n),(await $o(n,t)).token}(t,e)}}),"PRIVATE")),Me(lo,ho),Me(lo,ho,"esm2017");const Qo="analytics",Xo="firebase_id",Zo="origin",ea=6e4,ta="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",na="https://www.googletagmanager.com/gtag/js",ia=new ne("@firebase/analytics"),sa=new I("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function ra(e){if(!e.startsWith(na)){const t=sa.create("invalid-gtag-resource",{gtagURL:e});return ia.warn(t.message),""}return e}function oa(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const aa=30,ca=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function la(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function ha(e,t=ca,n){const{appId:i,apiKey:s,measurementId:r}=e.options;if(!i)throw sa.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw sa.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new da;return setTimeout((async()=>{a.abort()}),void 0!==n?n:ea),ua({appId:i,apiKey:s,measurementId:r},o,a,t)}async function ua(e,{throttleEndTimeMillis:t,backoffCount:n},i,s=ca){var r;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,i)=>{const s=Math.max(t-Date.now(),0),r=setTimeout(n,s);e.addEventListener((()=>{clearTimeout(r),i(sa.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(e){if(a)return ia.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:i}=e,s={method:"GET",headers:la(i)},r=ta.replace("{app-id}",n),o=await fetch(r,s);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw sa.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return s.deleteThrottleMetadata(o),t}catch(t){const c=t;if(!function(e){if(!(e instanceof w&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(s.deleteThrottleMetadata(o),a)return ia.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw t}const l=503===Number(null===(r=null==c?void 0:c.customData)||void 0===r?void 0:r.httpStatus)?H(n,s.intervalMillis,aa):H(n,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return s.setThrottleMetadata(o,h),ia.debug(`Calling attemptFetch again in ${l} millis`),ua(e,h,i,s)}}class da{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let pa,fa;async function _a(e,t,n,i,s,r,o){var a;const c=ha(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&ia.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>ia.error(e))),t.push(c);const l=async function(){if(!y())return ia.warn(sa.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await v()}catch(e){return ia.warn(sa.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[h,u]=await Promise.all([c,l]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(na)&&n.src.includes(e))return n;return null})(r)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:ra}),i=document.createElement("script"),s=`${na}?l=${e}&id=${t}`;i.src=n?null==n?void 0:n.createScriptURL(s):s,i.async=!0,document.head.appendChild(i)}(r,h.measurementId),fa&&(s("consent","default",fa),fa=void 0),s("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d[Zo]="firebase",d.update=!0,null!=u&&(d[Xo]=u),s("config",h.measurementId,d),pa&&(s("set",pa),pa=void 0),h.measurementId}class ma{constructor(e){this.app=e}_delete(){return delete ga[this.app.options.appId],Promise.resolve()}}let ga={},ya=[];const va={};let wa,Ia,ba="dataLayer",Ca=!1;function Ta(e,t,n){!function(){const e=[];if(m()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=sa.create("invalid-analytics-context",{errorInfo:t});ia.warn(n.message)}}();const i=e.options.appId;if(!i)throw sa.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw sa.create("no-api-key");ia.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=ga[i])throw sa.create("already-exists",{id:i});if(!Ca){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(ba);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,s){let r=function(...e){window[i].push(arguments)};return window[s]&&"function"==typeof window[s]&&(r=window[s]),window[s]=function(e,t,n,i){return async function(s,...r){try{if("event"===s){const[i,s]=r;await async function(e,t,n,i,s){try{let r=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const i=await oa(n);for(const n of e){const e=i.find((e=>e.measurementId===n)),s=e&&t[e.appId];if(!s){r=[];break}r.push(s)}}0===r.length&&(r=Object.values(t)),await Promise.all(r),e("event",i,s||{})}catch(e){ia.error(e)}}(e,t,n,i,s)}else if("config"===s){const[s,o]=r;await async function(e,t,n,i,s,r){const o=i[s];try{if(o)await t[o];else{const e=(await oa(n)).find((e=>e.measurementId===s));e&&await t[e.appId]}}catch(e){ia.error(e)}e("config",s,r)}(e,t,n,i,s,o)}else if("consent"===s){const[t]=r;e("consent","update",t)}else if("get"===s){const[t,n,i]=r;e("get",t,n,i)}else if("set"===s){const[t]=r;e("set",t)}else e(s,...r)}catch(e){ia.error(e)}}}(r,e,t,n),{gtagCore:r,wrappedGtag:window[s]}}(ga,ya,va,ba,"gtag");Ia=e,wa=t,Ca=!0}return ga[i]=_a(e,ya,va,t,wa,ba,n),new ma(e)}const Ea="@firebase/analytics",ka="0.10.0";function Sa(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}Pe(new $(Qo,((e,{options:t})=>Ta(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),Pe(new $("analytics-internal",(function(e){try{const t=e.getProvider(Qo).getImmediate();return{logEvent:(e,n,i)=>function(e,t,n,i){e=z(e),async function(e,t,n,i,s){if(s&&s.global)e("event",n,i);else{const s=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:s}))}}(Ia,ga[e.app.options.appId],t,n,i).catch((e=>ia.error(e)))}(t,e,n,i)}}catch(e){throw sa.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),Me(Ea,ka),Me(Ea,ka,"esm2017"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Na=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Pa=new I("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ra=new ne("@firebase/auth");function Da(e,...t){Ra.logLevel<=Q.ERROR&&Ra.error(`Auth (${Ae}): ${e}`,...t)}function Oa(e,...t){throw xa(e,...t)}function Aa(e,...t){return xa(e,...t)}function xa(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return Pa.create(e,...t)}function Ma(e,t,...n){if(!e)throw xa(t,...n)}function La(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Da(t),new Error(t)}function Fa(e,t){e||La(t)}function Ua(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class qa{constructor(e,t){this.shortDelay=e,this.longDelay=t,Fa(t>e,"Short delay should be less than long delay!"),this.isMobile=_()||g()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Ua()||"https:"===Ua()||m()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}class ja{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void La("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void La("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void La("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Wa={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Ba=new qa(3e4,6e4);function Va(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Ha(e,t,n,i,s={}){return za(e,s,(async()=>{let s={},r={};i&&("GET"===t?r=i:s={body:JSON.stringify(i)});const o=O(Object.assign({key:e.config.apiKey},r)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),ja.fetch()(Ka(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},s))}))}async function za(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},Wa),t);try{const t=new Ga(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw Ya(e,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const t=s.ok?r.errorMessage:r.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ya(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw Ya(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw Ya(e,"user-disabled",r);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(e,t,n){const i=Object.assign(Object.assign({},Na()),{[t]:n});return new I("auth","Firebase",i).create(t,{appName:e.name})}(e,a,o);Oa(e,a)}}catch(t){if(t instanceof w)throw t;Oa(e,"network-request-failed",{message:String(t)})}}async function $a(e,t,n,i,s={}){const r=await Ha(e,t,n,i,s);return"mfaPendingCredential"in r&&Oa(e,"multi-factor-auth-required",{_serverResponse:r}),r}function Ka(e,t,n,i){const s=`${t}${n}?${i}`;return e.config.emulator?function(e,t){Fa(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}(e.config,s):`${e.config.apiScheme}://${s}`}class Ga{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Aa(this.auth,"network-request-failed"))),Ba.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ya(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=Aa(e,t,i);return s.customData._tokenResponse=n,s}function Ja(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Qa(e){return 1e3*Number(e)}function Xa(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return Da("JWT malformed, contained fewer than 3 sections"),null;try{const e=c(n);return e?JSON.parse(e):(Da("Failed to decode base64 JWT payload"),null)}catch(e){return Da("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function Za(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof w&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ec{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class tc{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ja(this.lastLoginAt),this.creationTime=Ja(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function nc(e){var t;const n=e.auth,i=await e.getIdToken(),s=await Za(e,async function(e,t){return Ha(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:i}));Ma(null==s?void 0:s.users.length,n,"internal-error");const r=s.users[0];e._notifyReloadListener(r);const o=(null===(t=r.providerUserInfo)||void 0===t?void 0:t.length)?r.providerUserInfo.map((e=>{var{providerId:t}=e,n=Sa(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,l=o,[...c.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var c,l;const h=e.isAnonymous,u=!(e.email&&r.passwordHash||(null==a?void 0:a.length)),d=!!h&&u,p={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new tc(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(e,p)}class ic{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ma(e.idToken,"internal-error"),Ma(void 0!==e.idToken,"internal-error"),Ma(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=Xa(e);return Ma(t,"internal-error"),Ma(void 0!==t.exp,"internal-error"),Ma(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Ma(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(e,t){const n=await za(e,{},(async()=>{const n=O({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,r=Ka(e,i,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",ja.fetch()(r,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new ic;return n&&(Ma("string"==typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(Ma("string"==typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(Ma("number"==typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ic,this.toJSON())}_performRefresh(){return La("not implemented")}}function sc(e,t){Ma("string"==typeof e||void 0===e,"internal-error",{appName:t})}class rc{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=Sa(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ec(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new tc(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Za(this,this.stsTokenManager.getToken(this.auth,e));return Ma(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=z(e),i=await n.getIdToken(t),s=Xa(i);Ma(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const r="object"==typeof s.firebase?s.firebase:void 0,o=null==r?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:Ja(Qa(s.auth_time)),issuedAtTime:Ja(Qa(s.iat)),expirationTime:Ja(Qa(s.exp)),signInProvider:o||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=z(e);await nc(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Ma(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new rc(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ma(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await nc(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Za(this,async function(e,t){return Ha(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,r,o,a,c,l;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,p=null!==(r=t.photoURL)&&void 0!==r?r:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,_=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,g=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:y,emailVerified:v,isAnonymous:w,providerData:I,stsTokenManager:b}=t;Ma(y&&b,e,"internal-error");const C=ic.fromJSON(this.name,b);Ma("string"==typeof y,e,"internal-error"),sc(h,e.name),sc(u,e.name),Ma("boolean"==typeof v,e,"internal-error"),Ma("boolean"==typeof w,e,"internal-error"),sc(d,e.name),sc(p,e.name),sc(f,e.name),sc(_,e.name),sc(m,e.name),sc(g,e.name);const T=new rc({uid:y,auth:e,email:u,emailVerified:v,displayName:h,isAnonymous:w,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:C,createdAt:m,lastLoginAt:g});return I&&Array.isArray(I)&&(T.providerData=I.map((e=>Object.assign({},e)))),_&&(T._redirectEventId=_),T}static async _fromIdTokenResponse(e,t,n=!1){const i=new ic;i.updateFromServerResponse(t);const s=new rc({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await nc(s),s}}const oc=new Map;function ac(e){Fa(e instanceof Function,"Expected a class definition");let t=oc.get(e);return t?(Fa(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,oc.set(e,t),t)}class cc{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}cc.type="NONE";const lc=cc;function hc(e,t,n){return`firebase:${e}:${t}:${n}`}class uc{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=hc(this.userKey,i.apiKey,s),this.fullPersistenceKey=hc("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?rc._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new uc(ac(lc),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let s=i[0]||ac(lc);const r=hc(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(r);if(t){const i=rc._fromJSON(e,t);n!==s&&(o=i),s=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==s)try{await e._remove(r)}catch(e){}}))),new uc(s,e,n)):new uc(s,e,n)}}function dc(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(fc(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(function(e=f()){return/firefox\//i.test(e)}(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(mc(t))return"Blackberry";if(gc(t))return"Webos";if(pc(t))return"Safari";if((t.includes("chrome/")||function(e=f()){return/crios\//i.test(e)}(t))&&!t.includes("edge/"))return"Chrome";if(_c(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function pc(e=f()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function fc(e=f()){return/iemobile/i.test(e)}function _c(e=f()){return/android/i.test(e)}function mc(e=f()){return/blackberry/i.test(e)}function gc(e=f()){return/webos/i.test(e)}function yc(e=f()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function vc(e,t=[]){let n;switch(e){case"Browser":n=dc(f());break;case"Worker":n=`${dc(f())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ae}/${i}`}async function wc(e,t){return Ha(e,"GET","/v2/recaptchaConfig",Va(e,t))}function Ic(e){return void 0!==e&&void 0!==e.enterprise}class bc{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some((e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState))}}class Cc{constructor(e){this.type="recaptcha-enterprise",this.auth=Sc(e)}async verify(e="verify",t=!1){function n(t,n,i){const s=window.grecaptcha;Ic(s)?s.enterprise.ready((()=>{s.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{wc(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new bc(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((s=>{if(!t&&Ic(window.grecaptcha))n(s,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));(r="https://www.google.com/recaptcha/enterprise.js?render="+s,new Promise(((e,t)=>{const n=document.createElement("script");var i,s;n.setAttribute("src",r),n.onload=e,n.onerror=e=>{const n=Aa("internal-error");n.customData=e,t(n)},n.type="text/javascript",n.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(n)}))).then((()=>{n(s,e,i)})).catch((e=>{i(e)}))}var r})).catch((e=>{i(e)}))}))}}async function Tc(e,t,n,i=!1){const s=new Cc(e);let r;try{r=await s.verify(n)}catch(e){r=await s.verify(n,!0)}const o=Object.assign({},t);return i?Object.assign(o,{captchaResp:r}):Object.assign(o,{captchaResponse:r}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class Ec{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class kc{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Nc(this),this.idTokenSubscription=new Nc(this),this.beforeStateQueue=new Ec(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Pa,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ac(t)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await uc.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==r||!(null==o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Ma(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await nc(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?z(e):null;return t&&Ma(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ma(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(ac(e))}))}async initializeRecaptchaConfig(){const e=await wc(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new bc(e);null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled&&new Cc(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new I("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ac(e)||this._popupRedirectResolver;Ma(t,this,"argument-error"),this.redirectPersistenceManager=await uc.create(this,[ac(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t),r=this._isInitialized?Promise.resolve():this._initializationPromise;return Ma(r,this,"internal-error"),r.then((()=>s(this.currentUser))),"function"==typeof t?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ma(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=vc(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Ra.logLevel<=Q.WARN&&Ra.warn(`Auth (${Ae}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Sc(e){return z(e)}class Nc{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new L(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Ma(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class Pc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return La("not implemented")}_getIdTokenResponse(e){return La("not implemented")}_linkToIdToken(e,t){return La("not implemented")}_getReauthenticationResolver(e){return La("not implemented")}}async function Rc(e,t){return $a(e,"POST","/v1/accounts:signInWithPassword",Va(e,t))}class Dc extends Pc{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Dc(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Dc(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await Tc(e,n,"signInWithPassword");return Rc(e,t)}return Rc(e,n).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await Tc(e,n,"signInWithPassword");return Rc(e,t)}return Promise.reject(t)}));case"emailLink":return async function(e,t){return $a(e,"POST","/v1/accounts:signInWithEmailLink",Va(e,t))}(e,{email:this._email,oobCode:this._password});default:Oa(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return Ha(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return $a(e,"POST","/v1/accounts:signInWithEmailLink",Va(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Oa(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Oc(e,t){return $a(e,"POST","/v1/accounts:signInWithIdp",Va(e,t))}class Ac extends Pc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ac(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Oa("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=Sa(t,["providerId","signInMethod"]);if(!n||!i)return null;const r=new Ac(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(e){return Oc(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Oc(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Oc(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=O(t)}return e}}const xc={USER_NOT_FOUND:"user-not-found"};class Mc extends Pc{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Mc({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Mc({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return $a(e,"POST","/v1/accounts:signInWithPhoneNumber",Va(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await $a(e,"POST","/v1/accounts:signInWithPhoneNumber",Va(e,t));if(n.temporaryProof)throw Ya(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return $a(e,"POST","/v1/accounts:signInWithPhoneNumber",Va(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),xc)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}=e;return n||t||i||s?new Mc({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class Lc{constructor(e){var t,n,i,s,r,o;const a=A(x(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);Ma(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(r=a.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=A(x(e)).link,n=t?A(x(t)).deep_link_id:null,i=A(x(e)).deep_link_id;return(i?A(x(i)).link:null)||i||n||t||e}(e);try{return new Lc(t)}catch(e){return null}}}class Fc{constructor(){this.providerId=Fc.PROVIDER_ID}static credential(e,t){return Dc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Lc.parseLink(t);return Ma(n,"argument-error"),Dc._fromEmailAndCode(e,n.code,n.tenantId)}}Fc.PROVIDER_ID="password",Fc.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Fc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Uc{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class qc extends Uc{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class jc extends qc{constructor(){super("facebook.com")}static credential(e){return Ac._fromParams({providerId:jc.PROVIDER_ID,signInMethod:jc.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return jc.credentialFromTaggedObject(e)}static credentialFromError(e){return jc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return jc.credential(e.oauthAccessToken)}catch(e){return null}}}jc.FACEBOOK_SIGN_IN_METHOD="facebook.com",jc.PROVIDER_ID="facebook.com";class Wc extends qc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ac._fromParams({providerId:Wc.PROVIDER_ID,signInMethod:Wc.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Wc.credentialFromTaggedObject(e)}static credentialFromError(e){return Wc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Wc.credential(t,n)}catch(e){return null}}}Wc.GOOGLE_SIGN_IN_METHOD="google.com",Wc.PROVIDER_ID="google.com";class Bc extends qc{constructor(){super("github.com")}static credential(e){return Ac._fromParams({providerId:Bc.PROVIDER_ID,signInMethod:Bc.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Bc.credentialFromTaggedObject(e)}static credentialFromError(e){return Bc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Bc.credential(e.oauthAccessToken)}catch(e){return null}}}Bc.GITHUB_SIGN_IN_METHOD="github.com",Bc.PROVIDER_ID="github.com";class Vc extends qc{constructor(){super("twitter.com")}static credential(e,t){return Ac._fromParams({providerId:Vc.PROVIDER_ID,signInMethod:Vc.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Vc.credentialFromTaggedObject(e)}static credentialFromError(e){return Vc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Vc.credential(t,n)}catch(e){return null}}}Vc.TWITTER_SIGN_IN_METHOD="twitter.com",Vc.PROVIDER_ID="twitter.com";class Hc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const s=await rc._fromIdTokenResponse(e,n,i),r=zc(n);return new Hc({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=zc(n);return new Hc({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function zc(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class $c extends w{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,$c.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new $c(e,t,n,i)}}function Kc(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw $c._fromErrorAndOperation(e,n,t,i);throw n}))}new WeakMap;const Gc="__sak";class Yc{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Gc,"1"),this.storage.removeItem(Gc),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}(class extends Yc{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=f();return pc(e)||yc(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=function(e=f()){return yc(e)||_c(e)||gc(e)||mc(e)||/windows phone/i.test(e)||fc(e)}(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);!function(){const e=f();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||s===e.newValue||e.newValue===e.oldValue?i():setTimeout(i,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}).type="LOCAL";(class extends Yc{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}).type="SESSION";class Jc{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Jc(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!(null==r?void 0:r.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map((async e=>e(t.origin,s))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Qc(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Jc.receivers=[];Math.floor(1e6*Math.random()),new qa(3e4,6e4);class Xc{constructor(e){this.providerId=Xc.PROVIDER_ID,this.auth=Sc(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var i;const s=await n.verify();try{let r;if(Ma("string"==typeof s,e,"argument-error"),Ma("recaptcha"===n.type,e,"argument-error"),r="string"==typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){Ma("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Ha(e,"POST","/v2/accounts/mfaEnrollment:start",Va(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{Ma("signin"===t.type,e,"internal-error");const n=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;Ma(n,e,"missing-multi-factor-info");const o=await function(e,t){return Ha(e,"POST","/v2/accounts/mfaSignIn:start",Va(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Ha(e,"POST","/v1/accounts:sendVerificationCode",Va(e,t))}(e,{phoneNumber:r.phoneNumber,recaptchaToken:s});return t}}finally{n._reset()}}(this.auth,e,z(t))}static credential(e,t){return Mc._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Xc.credentialFromTaggedObject(t)}static credentialFromError(e){return Xc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Mc._fromTokenResponse(t,n):null}}Xc.PROVIDER_ID="phone",Xc.PHONE_SIGN_IN_METHOD="phone";class Zc extends Pc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Oc(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Oc(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Oc(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function el(e){return async function(e,t,n=!1){const i="signIn",s=await Kc(e,i,t),r=await Hc._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(r.user),r}(e.auth,new Zc(e),e.bypassAuthState)}function tl(e){const{auth:t,user:n}=e;return Ma(n,t,"internal-error"),async function(e,t,n=!1){const{auth:i}=e,s="reauthenticate";try{const r=await Za(e,Kc(i,s,t,e),n);Ma(r.idToken,i,"internal-error");const o=Xa(r.idToken);Ma(o,i,"internal-error");const{sub:a}=o;return Ma(e.uid===a,i,"user-mismatch"),Hc._forOperation(e,s,r)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Oa(i,"user-mismatch"),e}}(n,new Zc(e),e.bypassAuthState)}async function nl(e){const{auth:t,user:n}=e;return Ma(n,t,"internal-error"),async function(e,t,n=!1){const i=await Za(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Hc._forOperation(e,"link",i)}(n,new Zc(e),e.bypassAuthState)}class il{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=e;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return el;case"linkViaPopup":case"linkViaRedirect":return nl;case"reauthViaPopup":case"reauthViaRedirect":return tl;default:Oa(this.auth,"internal-error")}}resolve(e){Fa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Fa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const sl=new qa(2e3,1e4);class rl extends il{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,rl.currentPopupAction&&rl.currentPopupAction.cancel(),rl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ma(e,this.auth,"internal-error"),e}async onExecution(){Fa(1===this.filter.length,"Popup operations only handle one event");const e=Qc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Aa(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Aa(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,rl.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Aa(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,sl.get())};e()}}rl.currentPopupAction=null,new Map,new qa(3e4,6e4),new qa(5e3,15e3),new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]),encodeURIComponent("fac");var ol,al,cl="@firebase/auth",ll="1.1.0";class hl{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ma(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}null===(ol=u())||void 0===ol||ol._authIdTokenMaxAge,al="Browser",Pe(new $("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:r,authDomain:o}=n.options;Ma(r&&!r.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:r,authDomain:o,clientPlatform:al,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vc(al)},c=new kc(n,i,s,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(ac);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Pe(new $("auth-internal",(e=>{return t=Sc(e.getProvider("auth").getImmediate()),new hl(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),Me(cl,ll,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(al)),Me(cl,ll,"esm2017");const ul=function(e=function(e=Te){const t=ke.get(e);if(!t&&e===Te&&d())return xe();if(!t)throw De.create("no-app",{appName:e});return t}(),t){const n=Re(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=(e=>{const t=(e=>{var t,n;return null===(n=null===(t=u())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]})("database");e&&function(e,t,n,i={}){(e=z(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&ht("Cannot call useEmulator() after instance has already been initialized.");const s=e._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&ht('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Nt(Nt.OWNER);else if(i.mockUserToken){const t="string"==typeof i.mockUserToken?i.mockUserToken:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(r)),""].join(".")}(i.mockUserToken,e.app.options.projectId);r=new Nt(t)}!function(e,t,n,i){e.repoInfo_=new xt(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),i&&(e.authTokenProvider_=i)}(s,t,n,r)}(n,...e)}return n}(xe({apiKey:"AIzaSyAs1rLyOoMOvEomhIwtdVqu9PhOWfq0MHE",authDomain:"dashboard-test-4ff8e.firebaseapp.com",databaseURL:"https://dashboard-test-4ff8e-default-rtdb.firebaseio.com",projectId:"dashboard-test-4ff8e",storageBucket:"dashboard-test-4ff8e.appspot.com",messagingSenderId:"802722798473",appId:"1:802722798473:web:33de9d8fbdddc32047df58",measurementId:"G-Z9FTK26PHV"}));(function(e){e=z(e);const t=new Ur((()=>{})),n=new Vr(t);return function(e,t,n){const i=function(e,t){const n=t._path;let i=null;e.syncPointTree_.foreachOnPath(n,((e,t)=>{const s=cn(e,n);i=i||gs(t,s)}));let s=e.syncPointTree_.get(n);s?i=i||gs(s,Xt()):(s=new ps,e.syncPointTree_=e.syncPointTree_.set(n,s));const r=null!=i,o=r?new gi(i,!0,!1):null;return Ci(_s(s,t,Ui(e.pendingWriteTree_,t._path),r?o.getNode():Bn.EMPTY_NODE,r).viewCache_)}(e.serverSyncTree_,t);return null!=i?Promise.resolve(i):e.server_.get(t).then((i=>{const s=zn(i).withIndex(t._queryParams.getIndex());let r;if(Ps(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())r=ks(e.serverSyncTree_,t._path,s);else{const n=Ms(e.serverSyncTree_,t);r=Ns(e.serverSyncTree_,t._path,s,n)}return fr(e.eventQueue_,t._path,r),Ss(e.serverSyncTree_,t,n,null,!0),s}),(n=>(Er(e,"get for query "+T(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new Wr(t,new jr(e._repo,e._path),e._queryParams.getIndex())))})(function(e,t){return(e=z(e))._checkNotDeleted("ref"),void 0!==t?Br(e._root,t):e._root}(ul,"/")).catch((e=>{console.error(e)}))})();